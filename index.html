<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro de Inversiones Financieras</title>
    <script src="https://cdn.jsdelivr.net/npm/autonumeric@4.5.4/dist/autoNumeric.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #005C97 0%, #004a7c 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 2rem;
        }

        .section-header {
            font-size: 1.2rem;
            font-weight: 600;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid #005C97;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            color: #333;
        }

        .area-selector {
            margin-bottom: 1.5rem;
        }

        .area-selector label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            display: block;
        }

        .area-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .area-button {
            padding: 0.5rem 1rem;
            border: 2px solid #005C97;
            background: white;
            color: #005C97;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .area-button.active {
            background: #005C97;
            color: white;
        }

        .config-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #fff;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .add-document-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .add-document-btn:hover {
            background: #218838;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        .filter-selectors {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-group select,
        .form-group input {
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: white;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #005C97;
            box-shadow: 0 0 0 2px rgba(0, 92, 151, 0.1);
        }

        .form-group select:disabled,
        .form-group input:disabled {
            background-color: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }

        .dynamic-fields {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .dynamic-fields .form-group label {
            font-weight: 500;
            color: #555;
            font-size: 0.9rem;
        }

        .dynamic-fields .form-group input,
        .dynamic-fields .form-group select {
            padding: 0.7rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .document-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 2rem;
        }

        .document-fields {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.25rem;
            margin-top: 1rem;
        }

        .file-upload-group {
            display: flex;
            flex-direction: column;
        }

        .file-upload-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: 6px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: white;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .file-upload-area:hover {
            border-color: #005C97;
            background-color: #f8f9fa;
        }

        .file-upload-area .upload-text {
            font-size: 0.9rem;
            color: #666;
        }

        .file-upload-area .file-name {
            font-weight: 600;
            color: #005C97;
            margin-bottom: 0.25rem;
        }

        .action-button {
            display: block;
            margin: 2rem auto 0;
            padding: 0.75rem 2.5rem;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: not-allowed;
            transition: all 0.3s ease;
        }

        .action-button.enabled {
            background-color: #005C97;
            cursor: pointer;
        }

        .action-button.enabled:hover {
            background-color: #004a7c;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 92, 151, 0.3);
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
            border: 1px solid #c3e6cb;
        }

        .hidden {
            display: none !important;
        }

        .error-message {
            font-size: 13px;
            color: red;
            margin-top: 0.25rem;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dynamic-fields {
                grid-template-columns: repeat(3, 1fr);
            }

            .document-fields {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .filter-selectors {
                grid-template-columns: 1fr;
            }

            .dynamic-fields {
                grid-template-columns: repeat(2, 1fr);
            }

            .document-fields {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .dynamic-fields {
                grid-template-columns: 1fr;
            }

            body {
                padding: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Registro de Inversiones Financieras</h1>
        </div>

        <div class="content">
            <!-- Sección 1: Información general -->
            <div class="section-header">1. Información general de la inversión</div>

            <div class="filter-selectors">
                <div class="form-group">
                    <label for="claseActivo">Clase de Activo</label>
                    <select id="claseActivo" onchange="updateMercado()">
                        <option value="">Seleccione clase de activo</option>
                        <option value="Caja y Equivalentes de Efectivo">Caja y Equivalentes de Efectivo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="mercado">Mercado</label>
                    <select id="mercado" disabled onchange="updateSubcategoria()">
                        <option value="">Seleccione mercado</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="subcategoria">Subcategoría</label>
                    <select id="subcategoria" disabled onchange="updateTipoInstrumento()">
                        <option value="">Seleccione subcategoría</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="tipoInstrumento">Tipo de Instrumento</label>
                    <select id="tipoInstrumento" disabled onchange="showFields()">
                        <option value="">Seleccione tipo de instrumento</option>
                    </select>
                </div>
            </div>

            <div id="dynamicFields" class="dynamic-fields">
                <!-- Los campos se generarán dinámicamente aquí -->
            </div>

            <!-- Sección 2: Sustento Documentario -->
            <div class="section-header">2. Sustento documentario</div>

            <div class="document-section">
                <!-- Selector de área -->
                <div class="area-selector">
                    <label>Seleccione el área o tipo de documentos:</label>
                    <div class="area-buttons">
                        <button class="area-button active" onclick="selectArea('general')">General</button>
                        <button class="area-button" onclick="selectArea('tesoreria')">Tesorería</button>
                        <!-- <button class="area-button" onclick="selectArea('riesgo')">Riesgo</button>
                        <button class="area-button" onclick="selectArea('legal')">Legal</button> -->
                    </div>
                </div>

                <!-- Campos de documentos dinámicos -->
                <div id="documentFields" class="document-fields">
                    <!-- Los campos se generarán dinámicamente aquí -->
                </div>

                <!-- Sección de configuración (opcional) -->
                <div class="config-section">
                    <h4>🔧 Configuración avanzada</h4>
                    <p style="color: #666; font-size: 0.9rem;">Agregue documentos adicionales para el área seleccionada:
                    </p>
                    <input type="text" id="newDocumentName" placeholder="Nombre del nuevo documento"
                        style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; width: 250px;">
                    <button class="add-document-btn" onclick="addCustomDocument()">+ Agregar Documento</button>
                </div>
            </div>

            <button id="registerButton" class="action-button" onclick="registerInvestment()">Registrar</button>

            <div id="successMessage" class="success-message hidden"></div>
        </div>
    </div>

    <script>
        // ===================================================
        // ✅ FUNCIONES UTILITARIAS CENTRALIZADAS
        // ===================================================

        /**
         * Obtiene el valor numérico de un input, manejando AutoNumeric automáticamente
         * @param {HTMLElement} input - El elemento input
         * @param {Object} fieldConfig - Configuración del campo
         * @returns {number|string} - Valor parseado según el tipo de campo
         */
        function getCalculatedValue(input, fieldConfig) {
            if (fieldConfig.type === "text") {
                return input.value;
            } else if (fieldConfig.type === "number") {
                const autoNumericInstance = AutoNumeric.getAutoNumericElement(input);
                if (autoNumericInstance) {
                    return AutoNumeric.getNumber(input);
                } else {
                    return parseFloat(input.value) || 0;
                }
            }
            return input.value;
        }

        /**
         * Establece el valor en un input, manejando AutoNumeric automáticamente
         * @param {HTMLElement} input - El elemento input
         * @param {Object} fieldConfig - Configuración del campo
         * @param {number|string} value - Valor a establecer
         */
        /*function setCalculatedValue(input, fieldConfig, value) {
            if (fieldConfig.type === "text") {
                input.value = value;
            } else if (fieldConfig.type === "number") {
                const autoNumericInstance = AutoNumeric.getAutoNumericElement(input);
                if (autoNumericInstance) {
                    autoNumericInstance.set(value);
                } else {
                    input.value = typeof value === 'number' ? value.toFixed(2) : value;
                }
            } else {
                input.value = value;
            }
        }*/



        function setCalculatedValue(input, fieldConfig, value) {
            if (fieldConfig.type === "text") {
                input.value = value;
            } else if (fieldConfig.type === "number") {
                const autoNumericInstance = AutoNumeric.getAutoNumericElement(input);
                if (autoNumericInstance) {
                    // ✅ VALIDAR ANTES DE ESTABLECER
                    if (isNaN(value) || !isFinite(value)) {
                        console.warn(`Valor inválido para ${fieldConfig.label}:`, value);
                        autoNumericInstance.set(0);
                        return;
                    }

                    // ✅ LIMITAR RANGO
                    const safeValue = Math.max(-999999999999, Math.min(999999999999, value));

                    try {
                        autoNumericInstance.set(safeValue);
                    } catch (error) {
                        console.error(`Error al establecer valor en ${fieldConfig.label}:`, error);
                        autoNumericInstance.set(0);
                    }
                }
            }
        }


        /**
         * Busca un campo por su label y devuelve su valor
         * @param {string} label - El label del campo a buscar
         * @returns {number|string|null} - Valor del campo o null si no se encuentra
         */
        function getFieldValue(label) {
            const dynamicFields = document.getElementById('dynamicFields');
            const inputs = dynamicFields.querySelectorAll('input, select');

            for (let index = 0; index < currentFields.length; index++) {
                const fieldConfig = currentFields[index];
                if (fieldConfig.label === label) {
                    const input = inputs[index];
                    return getCalculatedValue(input, fieldConfig);
                }
            }
            return null;
        }

        /**
         * Busca un campo por su calculationId y devuelve el elemento input
         * @param {string} calculationId - El ID de cálculo del campo
         * @returns {Object|null} - Objeto con input, config e index o null si no se encuentra
         */
        function getFieldByCalculationId(calculationId) {
            const dynamicFields = document.getElementById('dynamicFields');
            const inputs = dynamicFields.querySelectorAll('input, select');

            for (let index = 0; index < currentFields.length; index++) {
                const fieldConfig = currentFields[index];
                if (fieldConfig.calculationId === calculationId) {
                    return {
                        input: inputs[index],
                        config: fieldConfig,
                        index
                    };
                }
            }
            return null;
        }


        const fieldMappingsUnificado = {
            "Depósitos BCRP": {
                // Para cálculo de plazo en días
                plazoDias: {
                    fechaInicio: "Fecha de operación",
                    fechaFin: "Fecha de vencimiento"
                },
                // Para cálculo de plazo de vencimiento (clasificación)
                plazoVencimiento: {
                    fechaInicio: "Fecha de operación",
                    fechaFin: "Fecha de vencimiento"
                }
            },

            "Certificado del BCRP": {
                // Para cálculo de plazo en días
                plazoDias: {
                    fechaInicio: "Fecha de emisión",        // 🎯 Correcto para días
                    fechaFin: "Fecha de redención"
                },
                // Para cálculo de plazo de vencimiento (clasificación)
                plazoVencimiento: {
                    fechaInicio: "Fecha de subasta",        // 🎯 Correcto para clasificación
                    fechaFin: "Fecha de redención"
                }
            },

            "Depósito a plazo": {
                plazoDias: {
                    fechaInicio: "Fecha de operación",
                    fechaFin: "Fecha de vencimiento"
                },
                plazoVencimiento: {
                    fechaInicio: "Fecha de operación",
                    fechaFin: "Fecha de vencimiento"
                }
            },

            "Instrumento sintético": {
                // Para cálculo de plazo en días
                plazoDias: {
                    fechaInicio: "Fecha de operación",
                    fechaFin: "Fecha de vencimiento"
                },
                // Para cálculo de plazo de vencimiento (clasificación)
                plazoVencimiento: {
                    fechaInicio: "Fecha de operación",
                    fechaFin: "Fecha de vencimiento"
                }
            },


            "Instrumento de corto plazo": {
                plazoDias: {
                    fechaInicio: "Fecha de emisión",
                    fechaFin: "Fecha de redención"
                },
                plazoVencimiento: {
                    fechaInicio: "Fecha de emisión",
                    fechaFin: "Fecha de redención"
                }
            }



            ,
            "Cuenta remunerada": {
                plazoDias: {
                    fechaInicio: "Fecha Inicio de Remuneración",
                    fechaFin: "Fecha Fin de Remuneración"
                },


            }
        };



        // ===================================================
        // ✅ FUNCIONES DE CÁLCULO REFACTORIZADAS
        // ===================================================

        /**
 * Calcula la conversión de Soles a Dólares
 */
        function calculateSolesToDollars() {
            const montoSoles = getFieldValue("Monto Soles");
            const tipoCambioSpot = getFieldValue("Tipo de cambio Spot"); // ✅ Cambio aquí
            const montoDolaresField = getFieldByCalculationId("monto_dolares_calc");

            if (montoSoles !== null && tipoCambioSpot !== null && montoDolaresField) {
                const resultado = montoSoles / tipoCambioSpot; // División para USD
                setCalculatedValue(montoDolaresField.input, montoDolaresField.config, resultado);
            }
        }



        /**
         * Calcula la conversión de Dólares a Soles  
         */
        function calculateDollarsToSoles() {
            const montoDolares = getFieldValue("Monto Dólares");
            const tipoCambioSpot = getFieldValue("Tipo de cambio Spot"); // ✅ Cambio aquí
            const montoSolesField = getFieldByCalculationId("monto_soles_calc");

            if (montoDolares !== null && tipoCambioSpot !== null && montoSolesField) {
                const resultado = montoDolares * tipoCambioSpot; // Multiplicación para PEN
                setCalculatedValue(montoSolesField.input, montoSolesField.config, resultado);
            }
        }

        function setupMontoCalculationListeners() {
            // Listeners para cálculo automático según la estructura
            const montoSolesInput = getFieldByCalculationId("monto_soles_input");
            const montoDolaresInput = getFieldByCalculationId("monto_dolares_input");

            /*
            if (montoSolesInput) {
                montoSolesInput.input.addEventListener('input', calculateSolesToDollars);
                montoSolesInput.input.addEventListener('change', calculateSolesToDollars);
            }

            if (montoDolaresInput) {
                montoDolaresInput.input.addEventListener('input', calculateDollarsToSoles);
                montoDolaresInput.input.addEventListener('change', calculateDollarsToSoles);
            }*/


            if (montoSolesInput) {
                montoSolesInput.input.addEventListener('input', () => {
                    calculateSolesToDollars();
                    updateMontoFromCalculated(); // 🆕 NUEVO
                });
                montoSolesInput.input.addEventListener('change', () => {  // ✅ AGREGAR ESTE
                    calculateSolesToDollars();
                    updateMontoFromCalculated(); // 🆕 NUEVO
                });
            }


            if (montoDolaresInput) {
                montoDolaresInput.input.addEventListener('input', () => {
                    calculateDollarsToSoles();
                    updateMontoFromCalculated(); // 🆕 NUEVO
                });
                montoDolaresInput.input.addEventListener('change', () => {  // ✅ AGREGAR ESTE
                    calculateDollarsToSoles();
                    updateMontoFromCalculated(); // 🆕 NUEVO
                });
            }



            // 🎯 Cambio: usar "Tipo de cambio Spot" en lugar de "tipo_cambio_spot"
            // Buscar por label en lugar de calculationId
            const tipoCambioField = (() => {
                for (let index = 0; index < currentFields.length; index++) {
                    if (currentFields[index].label === "Tipo de cambio Spot") {
                        const dynamicFields = document.getElementById('dynamicFields');
                        const inputs = dynamicFields.querySelectorAll('input, select');
                        return inputs[index];
                    }
                }
                return null;
            })();

            if (tipoCambioField) {
                tipoCambioField.addEventListener('input', () => {
                    calculateSolesToDollars();
                    calculateDollarsToSoles();
                });
                tipoCambioField.addEventListener('change', () => {
                    calculateSolesToDollars();
                    calculateDollarsToSoles();
                });
            }
        }


        function updateMontoFromCalculated() {
            // 1. Encontrar el campo "Estructura" para ver qué opción está seleccionada
            const estructuraValue = (() => {
                for (let i = 0; i < currentFields.length; i++) {
                    if (currentFields[i].label === "Estructura") {
                        const dynamicFields = document.getElementById('dynamicFields');
                        const inputs = dynamicFields.querySelectorAll('input, select');
                        return inputs[i].value;
                    }
                }
                return null;
            })();

            if (!estructuraValue) return;

            // 2. Encontrar el campo "Monto" para actualizarlo
            const montoField = (() => {
                for (let i = 0; i < currentFields.length; i++) {
                    if (currentFields[i].label === "Monto") {
                        const dynamicFields = document.getElementById('dynamicFields');
                        const inputs = dynamicFields.querySelectorAll('input, select');
                        return { input: inputs[i], config: currentFields[i] };
                    }
                }
                return null;
            })();

            if (!montoField) return;

            // 3. Según la estructura, tomar el valor del 2do campo (calculado)
            let valorParaElCampoMonto = 0;

            if (estructuraValue === "PEN-USD-PEN") {
                // El 2do campo es "Monto Dólares" (calculado)
                const montoDolaresCalc = getFieldByCalculationId("monto_dolares_calc");
                if (montoDolaresCalc) {
                    valorParaElCampoMonto = getCalculatedValue(montoDolaresCalc.input, montoDolaresCalc.config);
                }
            } else if (estructuraValue === "USD-PEN-USD") {
                // El 2do campo es "Monto Soles" (calculado)
                const montoSolesCalc = getFieldByCalculationId("monto_soles_calc");
                if (montoSolesCalc) {
                    valorParaElCampoMonto = getCalculatedValue(montoSolesCalc.input, montoSolesCalc.config);
                }
            }

            // 4. Actualizar el campo "Monto" con ese valor
            if (valorParaElCampoMonto > 0) {
                setCalculatedValue(montoField.input, montoField.config, valorParaElCampoMonto);
            }
        }


        /**
         * Calcula el plazo en días entre fecha de operación y vencimiento
         */
        function calculatePlazoDiasDeposito_original() {
            const fechaOperacion = getFieldValue("Fecha de operación");
            const fechaVencimiento = getFieldValue("Fecha de vencimiento");
            const plazoField = getFieldByCalculationId("plazo_dias_deposito");

            if (fechaOperacion && fechaVencimiento && plazoField) {
                const fecha1 = new Date(fechaOperacion);
                const fecha2 = new Date(fechaVencimiento);
                const diffTime = fecha2 - fecha1;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                setCalculatedValue(plazoField.input, plazoField.config, diffDays);

                // Recalcular interés después de actualizar plazo
                setTimeout(() => calculateInteresDeposito(), 50);
            }
        }

        /*const fieldMappingsPlazoDias = {
            "Depósitos BCRP": {
                fechaInicio: "Fecha de operación",
                fechaFin: "Fecha de vencimiento"
            },
            "Certificado del BCRP": {
                fechaInicio: "Fecha de emisión",
                fechaFin: "Fecha de redención"
            },
            "Depósito a plazo": {
                fechaInicio: "Fecha de operación",
                fechaFin: "Fecha de vencimiento"
            },
            "Instrumento de corto plazo": {
                fechaInicio: "Fecha de emisión",
                fechaFin: "Fecha de redención"
            }
            // ... más formularios
        };

        // ✅ Mapeo de campos por tipo de instrumento
        const fieldMappings = {
            "Depósitos BCRP": {
                fechaInicio: "Fecha de operación",
                fechaFin: "Fecha de vencimiento"
            },
            "Certificado del BCRP": {
                fechaInicio: "Fecha de subasta",
                fechaFin: "Fecha de redención"
            },
            "Depósito a plazo": {
                fechaInicio: "Fecha de operación",
                fechaFin: "Fecha de vencimiento"
            },
            "Instrumento de corto plazo": {
                fechaInicio: "Fecha de emisión",
                fechaFin: "Fecha de redención"
            }
            // ... más formularios
        };*/



        function calculatePlazoDiasDeposito_X() {
            // Detectar qué tipo de instrumento estamos usando
            const tipoInstrumento = document.getElementById('tipoInstrumento').value;
            const mapping = fieldMappingsPlazoDias[tipoInstrumento];

            if (!mapping) {
                console.log(`No hay mapeo definido para: ${tipoInstrumento}`);
                return;
            }

            console.log('mapping,', mapping)

            // Usar los campos según el mapeo
            const fechaOperacion = getFieldValue(mapping.fechaInicio);
            const fechaVencimiento = getFieldValue(mapping.fechaFin);

            const plazoField = getFieldByCalculationId("plazo_dias_deposito");

            if (fechaOperacion && fechaVencimiento && plazoField) {
                const fecha1 = new Date(fechaOperacion);
                const fecha2 = new Date(fechaVencimiento);
                const diffTime = fecha2 - fecha1;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                setCalculatedValue(plazoField.input, plazoField.config, diffDays);

                // Recalcular interés después de actualizar plazo
                setTimeout(() => calculateInteresDeposito(), 50);
            }
        }

        function calculatePlazoDiasDeposito() {
            const tipoInstrumento = document.getElementById('tipoInstrumento').value;
            const mapping = fieldMappingsUnificado[tipoInstrumento]?.plazoDias;

            if (!mapping) {
                console.log(`No hay mapeo de plazoDias definido para: ${tipoInstrumento}`);
                return;
            }

            console.log(`Usando mapping plazoDias para ${tipoInstrumento}:`, mapping);

            const fechaInicio = getFieldValue(mapping.fechaInicio);
            const fechaFin = getFieldValue(mapping.fechaFin);
            const plazoField = getFieldByCalculationId("plazo_dias_deposito");

            // alert('mapping', plazoField)
            if (fechaInicio && fechaFin && plazoField) {
                const fecha1 = new Date(fechaInicio);
                const fecha2 = new Date(fechaFin);
                const diffTime = fecha2 - fecha1;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                // Validación para fechas negativas
                if (diffDays < 0) {
                    mostrarErrorFecha(plazoField.input, `La ${mapping.fechaFin} debe ser posterior a ${mapping.fechaInicio}`);
                    setCalculatedValue(plazoField.input, plazoField.config, 0);
                    return;
                }

                limpiarErrorFecha(plazoField.input);
                setCalculatedValue(plazoField.input, plazoField.config, diffDays);

                // Recalcular interés
                setTimeout(() => calculateInteresDeposito(), 50);
            }
        }



        /**
         * Calcula el plazo de vencimiento (Corto/Largo) basado en días
         */
        function calculatePlazoVencimiento_enbaseaPLAZODIAS() {
            const plazoEnDias = getFieldValue("Plazo en días");
            const plazoVencimientoField = getFieldByCalculationId("plazo_vencimiento");

            if (plazoEnDias !== null && plazoVencimientoField) {
                const plazoTexto = plazoEnDias <= 365 ? "Corto" : "Largo";
                setCalculatedValue(plazoVencimientoField.input, plazoVencimientoField.config, plazoTexto);
            }
        }


        //NILTON ESTE METODO ES PRE CONSULTAS A FRANK

        function calculatePlazoVencimiento_XA() {
            // TODO: CONFIRMAR QUÉ ES "FECHA DE CORTE" - Por ahora usando Fecha de Operación
            const fechaOperacion = getFieldValue("Fecha de operación");
            const fechaVencimiento = getFieldValue("Fecha de vencimiento");
            const plazoVencimientoField = getFieldByCalculationId("plazo_vencimiento");

            if (fechaOperacion && fechaVencimiento && plazoVencimientoField) {
                const fecha1 = new Date(fechaOperacion);
                const fecha2 = new Date(fechaVencimiento);
                const diffTime = fecha2 - fecha1;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const plazoEnAnios = diffDays / 360;

                let plazoTexto;
                if (plazoEnAnios <= 1) {
                    plazoTexto = "Corto Plazo";
                } else if (plazoEnAnios <= 2) {
                    plazoTexto = "Mayor a 1 año hasta 2 años";
                } else if (plazoEnAnios <= 10) {
                    plazoTexto = "Mediano Plazo";
                } else {
                    plazoTexto = "Largo Plazo";
                }

                setCalculatedValue(plazoVencimientoField.input, plazoVencimientoField.config, plazoTexto);
            }
        }

        //NILTON ESTE METODO ES PLAZO COMO EL ANTERIO METODO PERO POR TIPO DE INSTRUMENTO:


        // ✅ Función universal que se adapta
        function calculatePlazoVencimiento_y() {
            // Detectar qué tipo de instrumento estamos usando
            const tipoInstrumento = document.getElementById('tipoInstrumento').value;
            const mapping = fieldMappings[tipoInstrumento];

            if (!mapping) {
                console.log(`No hay mapeo definido para: ${tipoInstrumento}`);
                return;
            }

            console.log('mapping,', mapping)

            // Usar los campos según el mapeo
            const fechaInicio = getFieldValue(mapping.fechaInicio);
            const fechaFin = getFieldValue(mapping.fechaFin);
            const plazoVencimientoField = getFieldByCalculationId("plazo_vencimiento");

            if (fechaInicio && fechaFin && plazoVencimientoField) {
                const fecha1 = new Date(fechaInicio);
                const fecha2 = new Date(fechaFin);
                const diffTime = fecha2 - fecha1;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const plazoEnAnios = diffDays / 360;

                let plazoTexto;
                if (plazoEnAnios <= 1) {
                    plazoTexto = "Corto Plazo";
                } else if (plazoEnAnios <= 2) {
                    plazoTexto = "Mayor a 1 año hasta 2 años";
                } else if (plazoEnAnios <= 10) {
                    plazoTexto = "Mediano Plazo";
                } else {
                    plazoTexto = "Largo Plazo";
                }

                setCalculatedValue(plazoVencimientoField.input, plazoVencimientoField.config, plazoTexto);
            }
        }


        function calculatePlazoVencimiento() {
            const tipoInstrumento = document.getElementById('tipoInstrumento').value;
            const mapping = fieldMappingsUnificado[tipoInstrumento]?.plazoVencimiento;

            if (!mapping) {
                console.log(`No hay mapeo de plazoVencimiento definido para: ${tipoInstrumento}`);
                return;
            }

            console.log(`Usando mapping plazoVencimiento para ${tipoInstrumento}:`, mapping);

            const fechaInicio = getFieldValue(mapping.fechaInicio);
            const fechaFin = getFieldValue(mapping.fechaFin);
            const plazoVencimientoField = getFieldByCalculationId("plazo_vencimiento");

            if (fechaInicio && fechaFin && plazoVencimientoField) {
                const fecha1 = new Date(fechaInicio);
                const fecha2 = new Date(fechaFin);
                const diffTime = fecha2 - fecha1;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const plazoEnAnios = diffDays / 360;

                let plazoTexto;
                if (plazoEnAnios <= 1) {
                    plazoTexto = "Corto Plazo";
                } else if (plazoEnAnios <= 2) {
                    plazoTexto = "Mayor a 1 año hasta 2 años";
                } else if (plazoEnAnios <= 10) {
                    plazoTexto = "Mediano Plazo";
                } else {
                    plazoTexto = "Largo Plazo";
                }

                setCalculatedValue(plazoVencimientoField.input, plazoVencimientoField.config, plazoTexto);
            }
        }


        // ===================================================
        // 🛠️ FUNCIONES DE UTILIDAD PARA ERRORES
        // ===================================================

        function mostrarErrorFecha(input, mensaje) {
            let errorSpan = input.parentElement.querySelector('.error-fecha');
            if (!errorSpan) {
                errorSpan = document.createElement('span');
                errorSpan.className = 'error-fecha';
                errorSpan.style.cssText = 'font-size: 12px; color: #dc3545; margin-top: 4px; display: block;';
                input.parentElement.appendChild(errorSpan);
            }
            errorSpan.textContent = `⚠️ ${mensaje}`;
            errorSpan.style.display = 'block';
            input.style.borderColor = '#dc3545';
        }

        function limpiarErrorFecha(input) {
            const errorSpan = input.parentElement.querySelector('.error-fecha');
            if (errorSpan) errorSpan.style.display = 'none';
            input.style.borderColor = '#ddd';
        }





        /**
         * Calcula el interés al vencimiento para depósitos simples
         * Fórmula: (((1+Tasa)^((Plazo en Días)/365))-1) * Monto
         */
        function calculateInteresDeposito() {
            /*const tasa = getFieldValue("Tasa (%)");
            const plazoEnDias = getFieldValue("Plazo en días");
            const monto = getFieldValue("Monto");
            const interesField = getFieldByCalculationId("interes_deposito_simple");
*/

            let tasa = getFieldValue("Tasa (%)");
            if (tasa === null) {
                const tasaField = getFieldByCalculationId("tasa_deposito");
                if (tasaField) tasa = getCalculatedValue(tasaField.input, tasaField.config);
            }

            // 🎯 CORREGIDO: Obtener plazo correctamente
            const plazoField = getFieldByCalculationId("plazo_dias_deposito");
            const plazoEnDias = plazoField ? getCalculatedValue(plazoField.input, plazoField.config) : null;

            const monto = getFieldValue("Monto");
            const interesField = getFieldByCalculationId("interes_deposito_simple");



            if (tasa !== null && plazoEnDias !== null && monto !== null && interesField) {
                const tasaDecimal = tasa / 100;
                const resultado = (Math.pow(1 + tasaDecimal, (plazoEnDias / 360)) - 1) * monto;

                setCalculatedValue(interesField.input, interesField.config, resultado);

                // Recalcular monto estimado después de actualizar interés
                setTimeout(() => calculateMontoEstimado(), 50);
            }
        }


        function calculateTasaTEASintetico_old() {
            // Detectar estructura para saber qué campos usar
            const estructuraValue = (() => {
                for (let i = 0; i < currentFields.length; i++) {
                    if (currentFields[i].label === "Estructura") {
                        const dynamicFields = document.getElementById('dynamicFields');
                        const inputs = dynamicFields.querySelectorAll('input, select');
                        return inputs[i].value;
                    }
                }
                return null;
            })();

            if (!estructuraValue) return;

            // D63 - 2do campo Forward (calculado)
            let d63Value = 0;
            if (estructuraValue === "PEN-USD-PEN") {
                const d63Field = getFieldByCalculationId("monto_soles_forward_calc");
                if (d63Field) d63Value = getCalculatedValue(d63Field.input, d63Field.config);
            } else if (estructuraValue === "USD-PEN-USD") {
                const d63Field = getFieldByCalculationId("monto_dolares_forward_calc");
                if (d63Field) d63Value = getCalculatedValue(d63Field.input, d63Field.config);
            }

            // D35 - 1er campo Spot (manual)
            let d35Value = 0;
            if (estructuraValue === "PEN-USD-PEN") {
                const d35Field = getFieldByCalculationId("monto_soles_input");
                if (d35Field) d35Value = getCalculatedValue(d35Field.input, d35Field.config);
            } else if (estructuraValue === "USD-PEN-USD") {
                const d35Field = getFieldByCalculationId("monto_dolares_input");
                if (d35Field) d35Value = getCalculatedValue(d35Field.input, d35Field.config);
            }

            // D46 - Plazo (días)
            const d46Field = getFieldByCalculationId("plazo_dias_deposito");
            const d46Value = d46Field ? getCalculatedValue(d46Field.input, d46Field.config) : 0;

            // Campo resultado
            const tasaTEAField = getFieldByCalculationId("tasa_tea_sintetico");

            // CÁLCULO: (D63/D35)^(360/D46) - 1
            if (d63Value > 0 && d35Value > 0 && d46Value > 0 && tasaTEAField) {
                const ratio = d63Value / d35Value;
                const exponente = 360 / d46Value;
                const resultado = Math.pow(ratio, exponente) - 1;

                // Convertir a porcentaje (multiplicar por 100)
                const porcentaje = resultado * 100;

                setCalculatedValue(tasaTEAField.input, tasaTEAField.config, porcentaje);
            }
        }

        function calculateTasaTEASintetico() {
            // Detectar estructura para saber qué campos usar
            const estructuraValue = (() => {
                for (let i = 0; i < currentFields.length; i++) {
                    if (currentFields[i].label === "Estructura") {
                        const dynamicFields = document.getElementById('dynamicFields');
                        const inputs = dynamicFields.querySelectorAll('input, select');
                        return inputs[i].value;
                    }
                }
                return null;
            })();

            if (!estructuraValue) return;

            // D63 - 2do campo Forward (calculado)
            let d63Value = 0;
            if (estructuraValue === "PEN-USD-PEN") {
                const d63Field = getFieldByCalculationId("monto_soles_forward_calc");
                if (d63Field) d63Value = getCalculatedValue(d63Field.input, d63Field.config);
            } else if (estructuraValue === "USD-PEN-USD") {
                const d63Field = getFieldByCalculationId("monto_dolares_forward_calc");
                if (d63Field) d63Value = getCalculatedValue(d63Field.input, d63Field.config);
            }

            // D35 - 1er campo Spot (manual)
            let d35Value = 0;
            if (estructuraValue === "PEN-USD-PEN") {
                const d35Field = getFieldByCalculationId("monto_soles_input");
                if (d35Field) d35Value = getCalculatedValue(d35Field.input, d35Field.config);
            } else if (estructuraValue === "USD-PEN-USD") {
                const d35Field = getFieldByCalculationId("monto_dolares_input");
                if (d35Field) d35Value = getCalculatedValue(d35Field.input, d35Field.config);
            }

            // D46 - Plazo (días)
            const d46Field = getFieldByCalculationId("plazo_dias_deposito");
            const d46Value = d46Field ? getCalculatedValue(d46Field.input, d46Field.config) : 0;

            // Campo resultado
            const tasaTEAField = getFieldByCalculationId("tasa_tea_sintetico");

            // CÁLCULO: (D63/D35)^(360/D46) - 1
            if (d63Value > 0 && d35Value > 0 && d46Value > 0 && tasaTEAField) {
                try {
                    const ratio = d63Value / d35Value;
                    const exponente = 360 / d46Value;
                    const resultado = Math.pow(ratio, exponente) - 1;

                    // Convertir a porcentaje (multiplicar por 100)
                    let porcentaje = resultado * 100;

                    // ✅ VALIDACIONES ADICIONALES
                    if (isNaN(porcentaje) || !isFinite(porcentaje)) {
                        console.warn('Tasa TEA Sintético: Resultado inválido, estableciendo en 0');
                        porcentaje = 0;
                    } else if (porcentaje < 0) {
                        console.warn('Tasa TEA Sintético: Resultado negativo, estableciendo en 0');
                        porcentaje = 0;
                    } else if (porcentaje > 999999) {
                        console.warn('Tasa TEA Sintético: Resultado muy alto, limitando a 999999');
                        porcentaje = 999999;
                    }

                    setCalculatedValue(tasaTEAField.input, tasaTEAField.config, porcentaje);
                } catch (error) {
                    console.error('Error en cálculo de Tasa TEA Sintético:', error);
                    setCalculatedValue(tasaTEAField.input, tasaTEAField.config, 0);
                }
            } else {
                // Si no hay valores válidos, establecer en 0
                if (tasaTEAField) {
                    setCalculatedValue(tasaTEAField.input, tasaTEAField.config, 0);
                }
            }
        }

        /**
         * Calcula el monto estimado al vencimiento (Monto + Interés)
         */
        function calculateMontoEstimado() {
            const monto = getFieldValue("Monto");
            const interes = getFieldValue("Interés al vencimiento");
            const montoEstimadoField = getFieldByCalculationId("monto_total_vencimiento");

            if (monto !== null && interes !== null && montoEstimadoField) {
                const resultado = monto + interes;
                setCalculatedValue(montoEstimadoField.input, montoEstimadoField.config, resultado);

                // 🆕 AGREGAR ESTA LÍNEA:
                setTimeout(() => updateForwardFromVencimiento(), 50);
            }
        }

        /**
         * Calcula el monto de adquisición (Valor nominal × Precio ÷ 100)
         */
        function calculateMontoAdquisicion() {
            const valorNominal = getFieldValue("Valor nominal adquirido");
            const precio = getFieldValue("Precio (%)");
            const montoAdquisicionField = getFieldByCalculationId("monto_adquisicion");

            if (valorNominal !== null && precio !== null && montoAdquisicionField) {
                const resultado = (valorNominal * precio) / 100;
                setCalculatedValue(montoAdquisicionField.input, montoAdquisicionField.config, resultado);
            }
        }

        /**
                 * Calcula el monto de adquisición (Valor nominal × Precio ÷ 100)
                 */
        function calculateInteresesAlVencimiento() {
            const valorNominal = getFieldValue("Valor nominal adquirido");
            const precio = getFieldValue("Precio (%)");
            const montoAdquisicionField = getFieldByCalculationId("intereses_al_vencimiento");

            if (valorNominal !== null && precio !== null && montoAdquisicionField) {
                const resultado = (valorNominal) * ((100 - precio) / 100);
                setCalculatedValue(montoAdquisicionField.input, montoAdquisicionField.config, resultado);
            }
        }





        /**
         * Configura todos los event listeners para cálculos automáticos
         */
        function setupCalculationListeners() {
            const dynamicFields = document.getElementById('dynamicFields');
            const inputs = dynamicFields.querySelectorAll('input, select');

            // ✅ CORREGIDO: Obtener tipoInstrumento ANTES de usarlo
            const tipoInstrumento = document.getElementById('tipoInstrumento').value;

            // Obtener mappings para el tipo actual
            const mappingPlazoDias = fieldMappingsUnificado[tipoInstrumento]?.plazoDias;
            const mappingPlazoVencimiento = fieldMappingsUnificado[tipoInstrumento]?.plazoVencimiento;



            currentFields.forEach((fieldConfig, index) => {
                const input = inputs[index];

                /*
                // Listeners para fechas (cálculo de plazos)
                if (fieldConfig.label === "Fecha de operación" || fieldConfig.label === "Fecha de vencimiento") {
                    input.addEventListener('change', calculatePlazoDiasDeposito);
                    input.addEventListener('change', calculatePlazoVencimiento);
                }*/


                // ✅ CORREGIDO: Listeners dinámicos para fechas según el mapeo
                // Listeners para plazo en días
                if (mappingPlazoDias && (
                    fieldConfig.label === mappingPlazoDias.fechaInicio ||
                    fieldConfig.label === mappingPlazoDias.fechaFin
                )) {
                    input.addEventListener('change', calculatePlazoDiasDeposito);
                }

                // Listeners para plazo de vencimiento
                if (mappingPlazoVencimiento && (
                    fieldConfig.label === mappingPlazoVencimiento.fechaInicio ||
                    fieldConfig.label === mappingPlazoVencimiento.fechaFin
                )) {
                    input.addEventListener('change', calculatePlazoVencimiento);
                }





                /*
                // Listeners para cálculo de interés
                if (fieldConfig.label === "Tasa (%)" ||
                    fieldConfig.label === "Plazo en días" ||
                    fieldConfig.label === "Monto") {
                    input.addEventListener('change', calculateInteresDeposito);
                    input.addEventListener('input', calculateInteresDeposito);
                }*/

                // Listeners para cálculo de interés
                if (fieldConfig.label === "Tasa (%)" ||
                    fieldConfig.label === "Tasa de depósito (%)" ||  // ← Agregar esta línea
                    fieldConfig.label === "Plazo en días" ||
                    fieldConfig.label === "Plazo (días)" ||          // ← Agregar esta línea
                    fieldConfig.label === "Monto") {
                    input.addEventListener('change', calculateInteresDeposito);
                    input.addEventListener('input', calculateInteresDeposito);
                }
                // Listeners para monto estimado
                if (fieldConfig.label === "Monto" ||
                    fieldConfig.calculationId === "interes_deposito_simple") {
                    input.addEventListener('change', () => setTimeout(calculateMontoEstimado, 100));
                    input.addEventListener('input', () => setTimeout(calculateMontoEstimado, 100));
                }

                // Listeners para monto de adquisición
                if (fieldConfig.label === "Valor nominal adquirido" ||
                    fieldConfig.label === "Precio (%)") {
                    input.addEventListener('change', calculateMontoAdquisicion);
                    input.addEventListener('input', calculateMontoAdquisicion);

                    input.addEventListener('change', calculateInteresesAlVencimiento);
                    input.addEventListener('input', calculateInteresesAlVencimiento);

                }


                // Listeners para Tasa TEA Sintético
                // currentFields.forEach((fieldConfig, index) => {
                //     const input = inputs[index];

                // Recalcular cuando cambien los campos que afectan la TEA
                if (fieldConfig.calculationId === "monto_soles_input" ||
                    fieldConfig.calculationId === "monto_dolares_input" ||
                    fieldConfig.calculationId === "monto_soles_forward_calc" ||
                    fieldConfig.calculationId === "monto_dolares_forward_calc" ||
                    fieldConfig.calculationId === "plazo_dias_deposito") {

                    input.addEventListener('change', () => setTimeout(calculateTasaTEASintetico, 100));
                    input.addEventListener('input', () => setTimeout(calculateTasaTEASintetico, 100));
                }
                // });


                // Listener para actualizar campos Forward cuando cambie monto estimado
                if (fieldConfig.calculationId === "monto_total_vencimiento") {
                    input.addEventListener('change', updateForwardFromVencimiento);
                    input.addEventListener('input', updateForwardFromVencimiento);
                }

                // Listener para actualizar campos Forward cuando cambie monto estimado
                // if (fieldConfig.calculationId === "monto_total_vencimiento") {
                //     input.addEventListener('change', () => {
                //         console.log("Monto vencimiento cambió:", input.value);
                //         setTimeout(() => updateForwardFromVencimiento(), 100);
                //     });
                //     input.addEventListener('input', () => {
                //         setTimeout(() => updateForwardFromVencimiento(), 100);
                //     });
                // }


            });
        }

        function setupMontoVencimientoListener() {
            console.log("Configurando listener para monto vencimiento...");

            // Buscar el campo "Monto estimado al vencimiento"
            const montoVencimientoField = getFieldByCalculationId("monto_total_vencimiento");

            if (montoVencimientoField) {
                // Remover listeners viejos para evitar duplicados
                montoVencimientoField.input.removeEventListener('change', updateForwardFromVencimiento);
                montoVencimientoField.input.removeEventListener('input', updateForwardFromVencimiento);

                // Agregar listeners nuevos
                montoVencimientoField.input.addEventListener('change', () => {
                    setTimeout(updateForwardFromVencimiento, 100);
                });

                montoVencimientoField.input.addEventListener('input', () => {
                    setTimeout(updateForwardFromVencimiento, 100);
                });
            }
        }

        // ===================================================
        // 🗂️ CONFIGURACIÓN DE DATOS
        // ===================================================

        // Configuración de documentos por área
        const documentRequirements = {
            "general": [
                "Informe de Riesgos",
                "Informe Legal",
                "Acta de Comité de Inversiones"
            ],
            "tesoreria": [
                "Cierre de Cotización",
                "Resultados de Subasta Adjudicada DPZ"
            ],
            "riesgo": [
                "Análisis de Riesgo Crediticio",
                "Matriz de Riesgos",
                "Informe de Stress Testing"
            ],
            "legal": [
                "Opinión Legal",
                "Contratos y Anexos",
                "Dictamen Jurídico"
            ]
        };

        let currentArea = 'general';
        let documentCounter = 0;

        // JSON de cuentas bancarias por mercado y unidad de negocio
        const bankAccountsData = {
            "Local": {
                "FCR-LEY N° 28046": {
                    "BANCO DE CRÉDITO": [
                        "N° 193-13814691-0-31",
                        "N° 193-14004253-0-09",
                        "N° 193-14004326-0-83",
                        "N° 193-16111242-0-81",
                        "N° 193-16695371-0-09"
                    ],
                    "INTERBANK": [
                        "200-3071337036",
                        "N° 200-3071337141",
                        "N° 200-3071337222",
                        "N° 200-3071337257",
                        "N° 200-3071337290"
                    ],
                    "BANCO DE LA NACIÓN": [
                        "N° 00-000-341835",
                        "N° 00-000-341843",
                        "N° 00-068-219051",
                        "N° 00-000-525278",
                        "N° 00-068-259169",
                        "N° 00-000-525243"
                    ]
                },
                "FCR-MACROFONDO": {
                    "BANCO DE CRÉDITO": [
                        "N° 193-1990153-0-54",
                        "N° 191-4217521-1-31"
                    ],
                    "SCOTIABANK PERÚ": [
                        "N° 970-0700108",
                        "N° 4732923-000-07"
                    ],
                    "BBVA PERÚ": [
                        "N° 0011-0661-02-00040907",
                        "N° 0011-0661-02-00040915"
                    ],
                    "INTERBANK": [
                        "N° 200-3067561380",
                        "N° 200-3068999825",
                        "N° 200-3076993051"
                    ]
                },
                "FCR-D.L.19990": {
                    "SCOTIABANK PERÚ": [
                        "N° 00-170-102-005017",
                        "N° 01-170-102-005118",
                        "N° 000-8046716",
                        "N° 000-8037110",
                        "N° 170-1122112",
                        "N° 970-0942460"
                    ],
                    "INTERBANK": [
                        "N° 200-3079380186"
                    ],
                    "BANCO DE LA NACIÓN": [
                        "N° 00-000-644935",
                        "N° 00-000-873241",
                        "N° 00-000-874310"
                    ]
                },
                "FCR-FCJIMMS-LEY N°29741": {
                    "INTERBANK": [
                        "N° 200-3070593039",
                        "N° 200-3090250880",
                        "N° 200-3202185393",
                        "N° 200-3202185571",
                        "N° 200-3202185644",
                        "N° 200-3202185806",
                        "N° 200-3202186012",
                        "N° 200-3202186080",
                        "N° 200-3202186110",
                        "N° 200-3202186160",
                        "N° 200-3240319255",
                        "N° 200-3300753235",
                        "N° 200-3364664783",
                        "N° 200-3418021743",
                        "N° 200-3469529377"
                    ],
                    "BANCO DE LA NACIÓN": [
                        "N° 00-068-315956",
                        "N° 00-068-315964"
                    ]
                },
                "FCR-PESCA PERU S.A.": {
                    "INTERBANK": [
                        "N° 200-3071337249"
                    ]
                },
                "FCR-PARAMONGA": {
                    "INTERBANK": [
                        "N° 200-3071337320"
                    ]
                },
                "FCR-EMSAL": {
                    "INTERBANK": [
                        "N° 200-3114431287"
                    ]
                },
                "FCR-ENTEL": {
                    "INTERBANK": [
                        "N° 200-3114431627"
                    ]
                },
                "FCR-ENAPU S.A.-D.S. N° 101-2010-EF": {
                    "INTERBANK": [
                        "N° 200-3114431945"
                    ]
                },
                "FCR-CENTROMIN": {
                    "INTERBANK": [
                        "N° 200-3114432003"
                    ]
                },
                "FCR-REP PESQ. LEY N° 30003": {
                    "INTERBANK": [
                        "N° 200-3114432054"
                    ],
                    "BANCO DE LA NACIÓN": [
                        "N° 00-068-335973",
                        "N° 00-068-335981"
                    ]
                },
                "FCR-RTP": {
                    "INTERBANK": [
                        "N° 200-3202186233"
                    ]
                },
                "FCR-ELECTROLIMA": {
                    "INTERBANK": [
                        "N° 200-3312203818"
                    ]
                },
                "FCR-BONOS DE RECONOCIMIENTO": {
                    "INTERBANK": [
                        "N° 200-3312207473"
                    ]
                },
                "FCR-BANMAT": {
                    "INTERBANK": [
                        "N° 200-3383342088"
                    ]
                },
                "FCR-ENATA": {
                    "INTERBANK": [
                        "N° 200-3114431740"
                    ]
                }
            },
            "Extranjero": {
                "FCR-MACROFONDO": {
                    "UBS SWITZERLAND AG": [
                        "N°  206-579632.60C"
                    ],
                    "BANCO CREDIT AGRICOLE INDOSUEZ SWITZERLAND SA": [
                        "N° 1455110"
                    ]
                }
            }
        };


        const investmentData = {

            "Caja y Equivalentes de Efectivo": {
                "Local": {
                    "Depósitos y certificados en el BCRP": {
                        "Depósitos BCRP": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },
                            {
                                "label": "Plazo de vencimiento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "plazo_vencimiento"
                            },
                            {
                                "label": "Entidad Financiera Adjudicada",
                                "type": "select",
                                "options": [
                                    "BANCO CENTRAL DE RESERVA DEL PERÚ"
                                ]
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Fecha de operación",
                                "type": "date"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Tipo de tasa",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Tasa (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Interés al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "interes_deposito_simple"
                            },
                            {
                                "label": "Monto estimado al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "monto_total_vencimiento"
                            },
                            {
                                "label": "Número de depósito",
                                "type": "text",
                                // "attributes": {
                                //     "step": "0.01"
                                // }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            }
                        ],

                        "Certificado del BCRP": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },



                            {
                                "label": "Plazo de vencimiento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "plazo_vencimiento"
                            },

                            {
                                "label": "Emisor",
                                "type": "select",
                                "options": [
                                    "BANCO CENTRAL DE RESERVA DEL PERÚ"
                                ]
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Rendimiento (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto de adquisición",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "monto_adquisicion"


                            },
                            {
                                "label": "Intereses al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "intereses_al_vencimiento"

                            },
                            // {
                            //     "label": "Plazo en días",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "1"
                            //     }
                            // },




                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },


                            // // ocultado por ususario
                            // {
                            //     "label": "Monto estimado al vencimiento",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "0.01"
                            //     },
                            //     "calculated": true,
                            //     "calculationId": "monto_total_vencimiento"
                            // },
                            {
                                "label": "Fecha de subasta",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de redención",
                                "type": "date"
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local",
                                    "Internacional"
                                ],
                                "special": "custody_type"
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [],
                                "special": "custody_name"
                            }
                        ]
                    },
                    "Depósitos en el Sistema Financiero": {
                        "Depósito a plazo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },
                            {
                                "label": "Plazo de vencimiento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "plazo_vencimiento"
                            },
                            {
                                "label": "Entidad Financiera Adjudicada",
                                "type": "select",
                                "options": [
                                    "BANCO CENTRAL DE RESERVA DEL PERÚ"
                                ]
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Fecha de operación",
                                "type": "date"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Tipo de tasa",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Tasa (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Interés al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "interes_deposito_simple"
                            },
                            {
                                "label": "Monto estimado al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "monto_total_vencimiento"
                            },
                            {
                                "label": "Número de depósito",
                                "type": "text",
                                // "attributes": {
                                //     "step": "0.01"
                                // }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            }

                        ],
                        "Instrumento sintético": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "plazo_vencimiento"
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": []
                            },

                            {
                                "label": "Grupo económico",
                                "type": "select",
                                "options": []
                            },

                            {
                                "label": "Estructura",
                                "type": "select",
                                "options": [

                                    "USD-PEN-USD",
                                    "PEN-USD-PEN"
                                ],
                                "special": "structure_selector" // ← Agregar esto

                            },


                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            }

                            ,
                            {
                                "label": "Entidad Financiera Spot/Forward",//pendiente compromiso
                                "type": "select",
                                "options": [
                                    // "INTERBANK",
                                    // "SCOTIABANK PERU",
                                    // "BCP",
                                    // "BBVA"
                                ]
                            },

                            {
                                "label": "Fecha de operación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },


                            {
                                "label": "Tipo de cambio Spot",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },

                            // {
                            //     "label": "Monto Soles",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "0.01"
                            //     }
                            // },

                            // {
                            //     "label": "Monto Dólares",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "0.01"
                            //     }
                            // },


                            {
                                "label": "Moneda DPZ",
                                "type": "text",

                                "attributes": {
                                    "readonly": true,
                                    // "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "moneda_dpz"

                            },





                            {
                                "label": "Entidad Financiera DPZ",//pendiente lista creo
                                "type": "select",
                                "options": [

                                ]
                            }, {
                                "label": "Monto",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "autoFilled": true // 🆕 AGREGAR ESTO

                            },
                            // {
                            //     "label": "Plazo (días)",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "1"
                            //     }
                            // },

                            {
                                "label": "Plazo (días)",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },


                            {
                                "label": "Tipo de tasa",
                                "type": "select",
                                "options": []
                            },

                            {
                                "label": "Tasa de depósito (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                },
                                "calculationId": "tasa_deposito" // ← Agregar esto

                            },
                            {
                                "label": "Interés al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "interes_deposito_simple"
                            },
                            {
                                "label": "Monto estimado al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "monto_total_vencimiento"
                            },
                            {
                                "label": "Número de depósito",
                                "type": "text",
                                // "attributes": {
                                //     "step": "0.01"
                                // }
                            },

                            {
                                "label": "Tipo de cambio Forward",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },

                            {
                                "label": "Tasa TEA Sintético (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                },
                                "calculated": true,
                                "calculationId": "tasa_tea_sintetico"
                            },
                        ],
                        "Instrumento estructurado": [],
                        "Cuenta remunerada": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                // "type": "select",
                                // "options": [
                                //     "Cortop",
                                //     "Largo"
                                // ]

                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true
                            },
                            {
                                "label": "Entidad Financiera Adjudicada",
                                "type": "select",
                                "options": [
                                    "BANCO DE CRÉDITO",
                                    "BANCO SCOTIABANK",
                                    "BANCO BBCA PERÚ",
                                    "BANCO INTERBANK",
                                    "BANCO DE LA NACIÓN"

                                ]
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Fecha Inicio de Remuneración",
                                "type": "date"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [


                                ]
                            },
                            {
                                "label": "Tipo de tasa",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Tasa (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },
                            {
                                "label": "Fecha Fin de Remuneración",
                                "type": "date"
                            },
                            // {
                            //     "label": "Interés al vencimiento",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "0.01"
                            //     }
                            // },
                            // {
                            //     "label": "Banco cuenta cargo",
                            //     "type": "select",
                            //     "options": [],
                            //     "special": "bank_account"
                            // },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            }
                        ]
                    },
                    "Instrumentos de corto plazo": {
                        "Instrumento de corto plazo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                // "type": "select",
                                // "options": [
                                //     "Corto",
                                //     "Largo"
                                // ]

                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "Destino de emisión",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Rendimiento (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto de adquisición",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Intereses al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Fecha de subasta",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de redención",
                                "type": "date"
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local",
                                    "Internacional"
                                ],
                                "special": "custody_type"
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [],
                                "special": "custody_name"
                            }
                        ],
                        "Papel comercial": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                // "type": "select",
                                // "options": [
                                //     "Corto",
                                //     "Largo"
                                // ]


                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "Destino de emisión",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Rendimiento (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto de adquisición",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Intereses al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Fecha de subasta",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de redención",
                                "type": "date"
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local",
                                    "Internacional"
                                ],
                                "special": "custody_type"
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [],
                                "special": "custody_name"
                            }
                        ],
                        "Pagarés": [],
                        "Operación de reporte": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                // "type": "select",
                                // "options": [
                                //     "Corto",
                                //     "Largo"
                                // ]

                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true
                            },

                            {
                                "label": "Fecha de inicio",
                                "type": "date"
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Prestamista",
                                "type": "select",
                                "options": [
                                    "Fondo Consolidado de Reservas(FCR)"
                                ]
                            },
                            {
                                "label": "Prestatario",
                                "type": "select",
                                "options": [
                                    "INTERBANK",
                                    "SCOTIABANK PERU",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "ISIN del valor a prestar",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Tipo de bono prestado",
                                "type": "select",
                                "options": [
                                    "Bono Soberano",
                                    "Bono Global",
                                    "Bono Titulizado Gobierno",
                                    "Bono Corporativo",
                                    "Bono Subordinado",
                                    "Bono Hipotecario",
                                    "bono Otros Sistema Financiero"
                                ]
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Valor de mercado de los bonos a reportar",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Haircut (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto del colateral recibido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de interés de operación (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Intereses de la operación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            }
                        ]
                    }
                },
                "Extranjero": {
                    "Depósitos en el Sistema Financiero": {
                        "Depósito a plazo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },
                            {
                                "label": "Plazo de vencimiento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "plazo_vencimiento"
                            },
                            {
                                "label": "Entidad Financiera Adjudicada",
                                "type": "select",
                                "options": [
                                    "BANCO CENTRAL DE RESERVA DEL PERÚ"
                                ]
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Fecha de operación",
                                "type": "date"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Tipo de tasa",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Tasa (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Interés al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "interes_deposito_simple"
                            },
                            {
                                "label": "Monto estimado al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "monto_total_vencimiento"
                            },
                            {
                                "label": "Número de depósito",
                                "type": "text",
                                // "attributes": {
                                //     "step": "0.01"
                                // }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            }
                        ],
                        "Instrumento sintético": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "plazo_vencimiento"
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": []
                            },

                            {
                                "label": "Grupo económico",
                                "type": "select",
                                "options": []
                            },

                            {
                                "label": "Estructura",
                                "type": "select",
                                "options": [

                                    // "USD-PEN-USD",
                                    "PEN-USD-PEN"
                                ],
                                "special": "structure_selector" // ← Agregar esto

                            },


                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            }

                            ,
                            {
                                "label": "Entidad Financiera Spot/Forward",//pendiente compromiso
                                "type": "select",
                                "options": [
                                    // "INTERBANK",
                                    // "SCOTIABANK PERU",
                                    // "BCP",
                                    // "BBVA"
                                ]
                            },

                            {
                                "label": "Fecha de operación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },


                            {
                                "label": "Tipo de cambio Spot",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },

                            // {
                            //     "label": "Monto Soles",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "0.01"
                            //     }
                            // },

                            // {
                            //     "label": "Monto Dólares",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "0.01"
                            //     }
                            // },


                            {
                                "label": "Moneda DPZ",
                                "type": "text",

                                "attributes": {
                                    "readonly": true,
                                    // "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "moneda_dpz"

                            },





                            {
                                "label": "Entidad Financiera DPZ",//pendiente lista creo
                                "type": "select",
                                "options": [

                                ]
                            }, {
                                "label": "Monto",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "autoFilled": true // 🆕 AGREGAR ESTO

                            },
                            // {
                            //     "label": "Plazo (días)",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "1"
                            //     }
                            // },

                            {
                                "label": "Plazo (días)",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },


                            {
                                "label": "Tipo de tasa",
                                "type": "select",
                                "options": []
                            },

                            {
                                "label": "Tasa de depósito (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                },
                                "calculationId": "tasa_deposito" // ← Agregar esto

                            },
                            {
                                "label": "Interés al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "interes_deposito_simple"
                            },
                            {
                                "label": "Monto estimado al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "monto_total_vencimiento"
                            },
                            {
                                "label": "Número de depósito",
                                "type": "text",
                                // "attributes": {
                                //     "step": "0.01"
                                // }
                            },

                            {
                                "label": "Tipo de cambio Forward",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },

                            {
                                "label": "Tasa TEA Sintético (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                },
                                "calculated": true,
                                "calculationId": "tasa_tea_sintetico"
                            },

                        ],
                        "Instrumento estructurado": [],
                        "Cuenta remunerada": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                // "type": "select",
                                // "options": [
                                //     "Cortop",
                                //     "Largo"
                                // ]

                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true
                            },
                            {
                                "label": "Entidad Financiera Adjudicada",
                                "type": "select",
                                "options": [
                                    "BANCO CREDIT AGRICOLE",
                                    "UBS SWITZERLAND AG",
                                ]
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Fecha Inicio de Remuneración",
                                "type": "date"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [


                                ]
                            },
                            {
                                "label": "Tipo de tasa",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Tasa (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },
                            {
                                "label": "Fecha Fin de Remuneración",
                                "type": "date"
                            },
                            // {
                            //     "label": "Interés al vencimiento",
                            //     "type": "number",
                            //     "attributes": {
                            //         "step": "0.01"
                            //     }
                            // },
                            // {
                            //     "label": "Banco cuenta cargo",
                            //     "type": "select",
                            //     "options": [],
                            //     "special": "bank_account"
                            // },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            }
                        ]

                    },
                    "Depósitos en el BCRP en moneda extranjera": {
                        "Depósitos BCRP": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },
                            {
                                "label": "Plazo de vencimiento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true,
                                "calculationId": "plazo_vencimiento"
                            },
                            {
                                "label": "Entidad Financiera Adjudicada",
                                "type": "select",
                                "options": [
                                    "BANCO CENTRAL DE RESERVA DEL PERÚ"
                                ]
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Fecha de operación",
                                "type": "date"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Tipo de tasa",
                                "type": "select",
                                "options": []
                            },
                            {
                                "label": "Tasa (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1",
                                    "readonly": true
                                },
                                "calculated": true,
                                "calculationId": "plazo_dias_deposito"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Interés al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "interes_deposito_simple"
                            },
                            {
                                "label": "Monto estimado al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                },
                                "calculated": true,
                                "calculationId": "monto_total_vencimiento"
                            },
                            {
                                "label": "Número de depósito",
                                "type": "text",
                                // "attributes": {
                                //     "step": "0.01"
                                // }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            }
                        ]
                    },
                    "Instrumentos de corto plazo": {
                        "Instrumento de corto plazo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                // "type": "select",
                                // "options": [
                                //     "Corto",
                                //     "Largo"
                                // ]

                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "Destino de emisión",
                                "type": "text"
                            },
                            {
                                "label": " ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Rendimiento (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto de adquisición",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Intereses al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Fecha de subasta",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de redención",
                                "type": "date"
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local",
                                    "Internacional"
                                ],
                                "special": "custody_type"
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [],
                                "special": "custody_name"
                            }
                        ],
                        "Papel comercial": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [],
                                "special": "business_unit"
                            },

                            {
                                "label": "Plazo de vencimiento",
                                // "type": "select",
                                // "options": [
                                //     "Corto",
                                //     "Largo"
                                // ]

                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se calculará automáticamente"
                                },
                                "calculated": true
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Clasificación de riesgos",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "Destino de emisión",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [

                                ]
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Rendimiento (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto de adquisición",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Intereses al vencimiento",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Plazo en días",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Fecha de subasta",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de redención",
                                "type": "date"
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [],
                                "special": "bank_account"
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [],
                                "special": "account_number"
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local",
                                    "Internacional"
                                ],
                                "special": "custody_type"
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [],
                                "special": "custody_name"
                            }
                        ]


                    }
                }


            },


            "Renta Fija": {
                "Local": {
                    "Gobierno": {
                        "Bono Soberano": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio sucio",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo de amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Liquidación",
                                "type": "text"
                            },
                            {
                                "label": "Fecha Liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto Operación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Interés corrido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto Liquidación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME 444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ],
                        "Bono Global": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio sucio",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo de amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Liquidación",
                                "type": "text"
                            },
                            {
                                "label": "Fecha Liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto Operación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Interés corrido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto Liquidación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME 444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ],
                        "Bono con Garantía de Gobierno": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio sucio",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo de amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Liquidación",
                                "type": "text"
                            },
                            {
                                "label": "Fecha Liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto Operación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Interés corrido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto Liquidación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME 444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ],
                        "Bono titulizado Gobierno": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio sucio",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo de amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Liquidación",
                                "type": "text"
                            },
                            {
                                "label": "Fecha Liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Monto Operación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Interés corrido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto Liquidación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME 444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ]
                    },
                    "Bonos Sistema Financiero": {
                        "Bono Corporativo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total de emisión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tasa cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ],
                        "Bono Subordinado": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total de emisión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tasa cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ],
                        "Bono Hipotecario": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total de emisión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tasa cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ],
                        "Bono Leasing": [],
                        "Otros Sistema Financiero": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total de emisión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tasa cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ]
                    },
                    "Bonos Empresas no Financieras": {
                        "Bono Corporativo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total de emisión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tasa cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ]
                    },
                    "Instrumentos Titulizados": {
                        "Bono en Fideicomiso": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Originador",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total en circulación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de interés",
                                "type": "text"
                            },
                            {
                                "label": "Tasa de interés cupón escalonada ",
                                "type": "text"
                            },
                            {
                                "label": "Tasa de interés del cupón actual (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Destino de emisión",
                                "type": "text"
                            },
                            {
                                "label": "Restricciones financieras",
                                "type": "text"
                            },
                            {
                                "label": "Garantías",
                                "type": "text"
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ],
                        "Bono Titulizados": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Originador",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total en circulación",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de interés",
                                "type": "text"
                            },
                            {
                                "label": "Tasa de interés cupón escalonada ",
                                "type": "text"
                            },
                            {
                                "label": "Tasa de interés del cupón actual (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de emisión",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Destino de emisión",
                                "type": "text"
                            },
                            {
                                "label": "Restricciones financieras",
                                "type": "text"
                            },
                            {
                                "label": "Garantías",
                                "type": "text"
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ]
                    },
                    "Instrumento de mediano plazo y largo plazo": {
                        "Instrumento de mediano plazo y largo plazo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total de emisión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tasa cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ]
                    },
                    "Fondos de Renta Fija": {
                        "Fondo privado de renta fija tradicional": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Nombre de la SAFI o General Partner",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Capital comprometido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de suscripçión del contrato",
                                "type": "date"
                            },
                            {
                                "label": "Periodo de inversión (PI)",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de inicio (PI)",
                                "type": "date"
                            },
                            {
                                "label": "Fecha fin (PI) ",
                                "type": "date"
                            },
                            {
                                "label": "Periodo de desinversión (PD) años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Fecha de inicio (PD)",
                                "type": "date"
                            },
                            {
                                "label": "Fecha fin (PD) ",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de término",
                                "type": "date"
                            },
                            {
                                "label": "Nombre de la persona de contacto(SAFI/GP)",
                                "type": "text"
                            },
                            {
                                "label": "Correo de la persona de contacto(SAFI/GP)",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "BBH",
                                    " Scotiabank",
                                    "BNY Mellon",
                                    "JP Morgan",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT 000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Información adicional: En caso se desee hacer una precisión adicional sobre el fondo",
                                "type": "textarea",
                                "attributes": {
                                    "rows": 4,
                                    "placeholder": "Ingrese observaciones relevantes"
                                }
                            }
                        ]
                    }
                },
                "Extranjero": {
                    "Mandato": {
                        "Mandato": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del Mandato",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del mandato",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Monto de inversión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de adquisión",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "BBH",
                                    " Scotiabank",
                                    "BNY Mellon",
                                    "JP Morgan",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT 000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ]
                    },
                    "Instrumentos de Deuda": {
                        "Instrumentos Organismos Supranacionales": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Tipo de oferta",
                                "type": "select",
                                "options": [
                                    "Publica",
                                    "Privada"
                                ]
                            },
                            {
                                "label": "Emisor",
                                "type": "text"
                            },
                            {
                                "label": "Denominación",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Nemónico",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Cantidad adquirida",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal unitario",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Valor nominal adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Monto total de emisión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de compra (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Periodicidad del cupón",
                                "type": "text"
                            },
                            {
                                "label": "Tasa cupón (%)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Tipo amortización",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de colocación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de liquidación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de vencimiento",
                                "type": "date"
                            },
                            {
                                "label": "Plazo en años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Tasa de rendimiento (TIR)",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Nombre de custodia",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            }
                        ],
                        "Inversiones en Notas y depósitos estructurados": []
                    },
                    "Fondos de Renta Fija": {
                        "Fondo mutuo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del fondo",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Numero de cuotas adquiridas",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio de valor de cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de valor de cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ],
                        "ETF": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del fondo",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Numero de cuotas adquiridas",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio de valor de cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de valor de cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ],
                        "Fondo privado": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Nombre de la SAFI o General Partner",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Capital comprometido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de suscripçión del contrato",
                                "type": "date"
                            },
                            {
                                "label": "Periodo de inversión (PI)",
                                "type": "text"
                            },
                            {
                                "label": "Fecha de inicio (PI)",
                                "type": "date"
                            },
                            {
                                "label": "Fecha fin (PI) ",
                                "type": "date"
                            },
                            {
                                "label": "Periodo de desinversión (PD) años",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Fecha de inicio (PD)",
                                "type": "date"
                            },
                            {
                                "label": "Fecha fin (PD) ",
                                "type": "date"
                            },


                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de término",
                                "type": "date"
                            },
                            {
                                "label": "Nombre de la persona de contacto(SAFI/GP)",
                                "type": "text"
                            },
                            {
                                "label": "Correo de la persona de contacto(SAFI/GP)",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "BBH",
                                    " Scotiabank",
                                    "BNY Mellon",
                                    "JP Morgan",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ]
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT 000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Información adicional: En caso se desee hacer una precisión adicional sobre el fondo",
                                "type": "textarea",
                                "attributes": {
                                    "rows": 4,
                                    "placeholder": "Ingrese observaciones relevantes"
                                }
                            }
                        ]
                    }
                }
            },
            "Renta Variable": {
                "Local": {
                    "Mandato": {
                        "Mandato": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del Mandato",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del mandato",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Monto de inversión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de adquisición",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ]
                    },
                    "Fondos mutuos": {
                        "Fondo mutuo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del fondo",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Número de cuotas adquiridas",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio de valor cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de valor cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ]
                    }
                },
                "Extranjero": {
                    "Mandato": {
                        "Mandato": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del Mandato",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del mandato",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Monto de inversión",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de adquisición",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ]
                    },
                    "Inversión Directa en instrumentos de capital": {
                        "Fondo mutuo": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del fondo",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Número de cuotas adquiridas",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio de valor cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de valor cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ],
                        "ETF": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del fondo",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Número de cuotas adquiridas",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio de valor cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de valor cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ]
                    }
                }
            },
            "Inversiones Alternativas": {
                "Local": {
                    "Inversiones inmobiliarias": {
                        "Inmobiliarias": []
                    },
                    "Fondos de inversión": {
                        "Fondo alternativo privado": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Nombre de la SAFI o General Partner",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Capital comprometido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de suscripición del contrato",
                                "type": "date"
                            },
                            {
                                "label": "Nombre de la persona de contacto (SAFI/GP)",
                                "type": "text"
                            },
                            {
                                "label": "Correo de la persona de contacto (SAFI/GP)",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Plazo (años) : (en caso sea un plazo indeterminado se deja en blanco)",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT 000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Información adicional: En caso se desee hacer una precisión adicional sobre el fondo ",
                                "type": "textarea",
                                "attributes": {
                                    "rows": 4,
                                    "placeholder": "Ingrese observaciones relevantes"
                                }
                            }
                        ]
                    }
                },
                "Extranjero": {
                    "Mandatos de Private Equity": {
                        "Fondo alternativo privado": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Nombre de la SAFI o General Partner",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Capital comprometido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de suscripición del contrato",
                                "type": "date"
                            },
                            {
                                "label": "Nombre de la persona de contacto (SAFI/GP)",
                                "type": "text"
                            },
                            {
                                "label": "Correo de la persona de contacto (SAFI/GP)",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Plazo (años) : (en caso sea un plazo indeterminado se deja en blanco)",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT 000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Información adicional: En caso se desee hacer una precisión adicional sobre el fondo ",
                                "type": "textarea",
                                "attributes": {
                                    "rows": 4,
                                    "placeholder": "Ingrese observaciones relevantes"
                                }
                            }
                        ]
                    },
                    "Inversión Directa en Private Equity": {
                        "Fondo alternativo privado": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Nombre de la SAFI o General Partner",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Capital comprometido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de suscripición del contrato",
                                "type": "date"
                            },
                            {
                                "label": "Nombre de la persona de contacto (SAFI/GP)",
                                "type": "text"
                            },
                            {
                                "label": "Correo de la persona de contacto (SAFI/GP)",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Plazo (años) : (en caso sea un plazo indeterminado se deja en blanco)",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT 000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Información adicional: En caso se desee hacer una precisión adicional sobre el fondo ",
                                "type": "textarea",
                                "attributes": {
                                    "rows": 4,
                                    "placeholder": "Ingrese observaciones relevantes"
                                }
                            }
                        ]
                    },
                    "Fondos de Real Assets": {
                        "Fondo alternativo público": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Tipo de estrategia de inversión",
                                "type": "text"
                            },
                            {
                                "label": "Gestor del fondo",
                                "type": "text"
                            },
                            {
                                "label": "ISIN",
                                "type": "text",
                                "attributes": {
                                    "placeholder": "Ej: US0378331005"
                                }
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Número de cuotas adquiridas",
                                "type": "number",
                                "attributes": {
                                    "step": "0.0001"
                                }
                            },
                            {
                                "label": "Precio de valor cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Precio de valor cuota adquirido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de negociación",
                                "type": "date"
                            },
                            {
                                "label": "Fecha de compra",
                                "type": "date"
                            },
                            {
                                "label": "Nombre del contacto",
                                "type": "text"
                            },
                            {
                                "label": "Correo electrónico",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT 000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            }
                        ],
                        "Fondo alternativo privado": [
                            {
                                "label": "Código del instrumento",
                                "type": "text",
                                "attributes": {
                                    "readonly": true,
                                    "placeholder": "Se generará automáticamente"
                                },
                                "autogenerated": true
                            },
                            {
                                "label": "Unidad de negocio",
                                "type": "select",
                                "options": [
                                    "MACROFONDO", "NO MACROFONDO"
                                ]
                            },
                            {
                                "label": "Tipo de operación",
                                "type": "select",
                                "options": [
                                    "Compra",
                                    "Venta"
                                ]
                            },
                            {
                                "label": "Plazo calificación",
                                "type": "select",
                                "options": [
                                    "Corto",
                                    "Largo"
                                ]
                            },
                            {
                                "label": "Nombre del fondo",
                                "type": "text"
                            },
                            {
                                "label": "Nombre de la SAFI o General Partner",
                                "type": "text"
                            },
                            {
                                "label": "Moneda",
                                "type": "select",
                                "options": [
                                    "PEN",
                                    "USD",
                                    "EUR",
                                    "JPY"
                                ]
                            },
                            {
                                "label": "Capital comprometido",
                                "type": "number",
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Fecha de suscripición del contrato",
                                "type": "date"
                            },
                            {
                                "label": "Nombre de la persona de contacto (SAFI/GP)",
                                "type": "text"
                            },
                            {
                                "label": "Correo de la persona de contacto (SAFI/GP)",
                                "type": "email",
                                "attributes": {
                                    "placeholder": "ejemplo@correo.com"
                                }
                            },
                            {
                                "label": "Plazo (años) : (en caso sea un plazo indeterminado se deja en blanco)",
                                "type": "number",
                                "attributes": {
                                    "step": "1"
                                }
                            },
                            {
                                "label": "Activo custodiado",
                                "type": "select",
                                "options": [
                                    "Si",
                                    "No"
                                ]
                            },
                            {
                                "label": "Nombre del custodio",
                                "type": "select",
                                "options": [
                                    "Scotiabank",
                                    "JP Morgan",
                                    "BBH",
                                    "State Street"
                                ]
                            },
                            {
                                "label": "Tipo de custodia",
                                "type": "select",
                                "options": [
                                    "Local-ONP",
                                    "Internacional-ONP",
                                    "Internacional-FCR"
                                ],
                                "attributes": {
                                    "step": "0.01"
                                }
                            },
                            {
                                "label": "Banco cuenta de cargo",
                                "type": "select",
                                "options": [
                                    "SCOTIABANK PERU",
                                    "INTERBANK",
                                    "BCP",
                                    "BBVA"
                                ]
                            },
                            {
                                "label": "N° de Cuenta Bancaria",
                                "type": "select",
                                "options": [
                                    "SCOT 000-4732923-MACROFONDO",
                                    "Ahorros MN 970-0700108",
                                    "Ahorros ME-444-8798234"
                                ]
                            },
                            {
                                "label": "Información adicional: En caso se desee hacer una precisión adicional sobre el fondo ",
                                "type": "textarea",
                                "attributes": {
                                    "rows": 4,
                                    "placeholder": "Ingrese observaciones relevantes"
                                }
                            }
                        ],
                        "Fondo mutuo": []
                    }
                }
            }


        }


        // Variables de estado
        let currentFields = [];
        let currentMarket = '';
        let currentBusinessUnit = '';
        let currentBankAccount = '';

        const riskClassificationOptions = ["A+", "AAA", "A", "AA", "1", "S/R", "AA+", "AA-", "BBB", "S", "E", "A-", "BBB-", "BBB+", "Sin Categoría"];

        const centralizedOptions = {
            "Clasificación de riesgos": riskClassificationOptions,
            "Moneda": ["PEN", "USD", "EUR"],
            "Tipo de tasa": ["TEA", "TNA", "VAC", "Variable"]
        };

        let filesUploaded = {
            informeRiesgos: false,
            informeLegal: false,
            actaComite: false
        };

        // ===================================================
        // 🔧 FUNCIONES UTILITARIAS GENERALES
        // ===================================================

        // Función para generar código automático
        function generateCode() {
            const timestamp = Date.now();
            return `INV-${timestamp.toString().slice(-8)}`;
        }

        // Función para obtener las unidades de negocio disponibles según el mercado
        function getBusinessUnits(market) {
            if (bankAccountsData[market]) {
                return Object.keys(bankAccountsData[market]);
            }
            return [];
        }

        // Función para obtener los bancos disponibles según mercado y unidad de negocio
        function getBankAccounts(market, businessUnit) {
            if (bankAccountsData[market] && bankAccountsData[market][businessUnit]) {
                return Object.keys(bankAccountsData[market][businessUnit]);
            }
            return [];
        }

        // Función para obtener las cuentas bancarias disponibles según mercado, unidad de negocio y banco
        function getAccountNumbers(market, businessUnit, bankAccount) {
            if (bankAccountsData[market] &&
                bankAccountsData[market][businessUnit] &&
                bankAccountsData[market][businessUnit][bankAccount]) {
                return bankAccountsData[market][businessUnit][bankAccount];
            }
            return [];
        }

        // ===================================================
        // 🔄 FUNCIONES DE ACTUALIZACIÓN DE SELECTORES
        // ===================================================

        // Función para actualizar mercado
        function updateMercado() {
            const successMessage = document.getElementById('successMessage');
            successMessage.classList.add('hidden');
            successMessage.textContent = '';

            const claseActivo = document.getElementById('claseActivo').value;
            const mercadoSelect = document.getElementById('mercado');
            const subcategoriaSelect = document.getElementById('subcategoria');
            const tipoInstrumentoSelect = document.getElementById('tipoInstrumento');
            const dynamicFields = document.getElementById('dynamicFields');

            // Limpiar selectores dependientes
            mercadoSelect.innerHTML = '<option value="">Seleccione mercado</option>';
            subcategoriaSelect.innerHTML = '<option value="">Seleccione subcategoría</option>';
            tipoInstrumentoSelect.innerHTML = '<option value="">Seleccione tipo de instrumento</option>';
            dynamicFields.innerHTML = '';

            // Deshabilitar selectores dependientes
            subcategoriaSelect.disabled = true;
            tipoInstrumentoSelect.disabled = true;

            // Reset variables
            currentMarket = '';
            currentBusinessUnit = '';
            currentBankAccount = '';

            if (claseActivo && investmentData[claseActivo]) {
                mercadoSelect.disabled = false;
                const mercados = Object.keys(investmentData[claseActivo]);

                mercados.forEach(mercado => {
                    const option = document.createElement('option');
                    option.value = mercado;
                    option.textContent = mercado;
                    mercadoSelect.appendChild(option);
                });
            } else {
                mercadoSelect.disabled = true;
            }

            checkFormCompletion();
        }

        // Función para actualizar subcategoría
        function updateSubcategoria() {
            const successMessage = document.getElementById('successMessage');
            successMessage.classList.add('hidden');
            successMessage.textContent = '';

            const claseActivo = document.getElementById('claseActivo').value;
            const mercado = document.getElementById('mercado').value;
            const subcategoriaSelect = document.getElementById('subcategoria');
            const tipoInstrumentoSelect = document.getElementById('tipoInstrumento');
            const dynamicFields = document.getElementById('dynamicFields');

            // Guardar mercado actual
            currentMarket = mercado;

            // Limpiar selectores dependientes
            subcategoriaSelect.innerHTML = '<option value="">Seleccione subcategoría</option>';
            tipoInstrumentoSelect.innerHTML = '<option value="">Seleccione tipo de instrumento</option>';
            dynamicFields.innerHTML = '';

            // Deshabilitar selector dependiente
            tipoInstrumentoSelect.disabled = true;

            // Reset variables
            currentBusinessUnit = '';
            currentBankAccount = '';

            if (claseActivo && mercado && investmentData[claseActivo] && investmentData[claseActivo][mercado]) {
                subcategoriaSelect.disabled = false;
                const subcategorias = Object.keys(investmentData[claseActivo][mercado]);

                subcategorias.forEach(subcategoria => {
                    const option = document.createElement('option');
                    option.value = subcategoria;
                    option.textContent = subcategoria;
                    subcategoriaSelect.appendChild(option);
                });
            } else {
                subcategoriaSelect.disabled = true;
            }

            checkFormCompletion();
        }

        // Función para actualizar tipo de instrumento
        function updateTipoInstrumento() {
            const successMessage = document.getElementById('successMessage');
            successMessage.classList.add('hidden');
            successMessage.textContent = '';

            const claseActivo = document.getElementById('claseActivo').value;
            const mercado = document.getElementById('mercado').value;
            const subcategoria = document.getElementById('subcategoria').value;
            const tipoInstrumentoSelect = document.getElementById('tipoInstrumento');
            const dynamicFields = document.getElementById('dynamicFields');

            // Limpiar campos dinámicos
            tipoInstrumentoSelect.innerHTML = '<option value="">Seleccione tipo de instrumento</option>';
            dynamicFields.innerHTML = '';

            // Reset variables
            currentBusinessUnit = '';
            currentBankAccount = '';

            if (claseActivo && mercado && subcategoria &&
                investmentData[claseActivo] &&
                investmentData[claseActivo][mercado] &&
                investmentData[claseActivo][mercado][subcategoria]) {

                tipoInstrumentoSelect.disabled = false;
                const tiposInstrumento = Object.keys(investmentData[claseActivo][mercado][subcategoria]);

                tiposInstrumento.forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo;
                    option.textContent = tipo;
                    tipoInstrumentoSelect.appendChild(option);
                });
            } else {
                tipoInstrumentoSelect.disabled = true;
            }

            checkFormCompletion();
        }

        // ===================================================
        // 🏗️ FUNCIÓN PRINCIPAL PARA MOSTRAR CAMPOS DINÁMICOS
        // ===================================================

        function showFields() {
            const successMessage = document.getElementById('successMessage');
            successMessage.classList.add('hidden');
            successMessage.textContent = '';

            const claseActivo = document.getElementById('claseActivo').value;
            const mercado = document.getElementById('mercado').value;
            const subcategoria = document.getElementById('subcategoria').value;
            const tipoInstrumento = document.getElementById('tipoInstrumento').value;
            const dynamicFields = document.getElementById('dynamicFields');

            // Limpiar campos dinámicos
            dynamicFields.innerHTML = '';
            currentFields = [];

            // Reset variables
            currentBusinessUnit = '';
            currentBankAccount = '';

            if (claseActivo && mercado && subcategoria && tipoInstrumento &&
                investmentData[claseActivo] &&
                investmentData[claseActivo][mercado] &&
                investmentData[claseActivo][mercado][subcategoria] &&
                investmentData[claseActivo][mercado][subcategoria][tipoInstrumento]) {

                const fields = investmentData[claseActivo][mercado][subcategoria][tipoInstrumento];
                currentFields = fields;

                let custodyTypeElement = null;
                let custodyNameElement = null;

                fields.forEach((fieldConfig, index) => {
                    const fieldGroup = document.createElement('div');
                    fieldGroup.className = 'form-group';

                    const label = document.createElement('label');
                    label.textContent = fieldConfig.label;

                    let input;
                    if (fieldConfig.type === 'select') {
                        input = document.createElement('select');
                        input.innerHTML = '<option value="">Seleccione</option>';

                        if (fieldConfig.options && fieldConfig.options.length > 0) {
                            fieldConfig.options.forEach(option => {
                                const optionElement = document.createElement('option');
                                optionElement.value = option;
                                optionElement.textContent = option;
                                input.appendChild(optionElement);
                            });
                        } else if (fieldConfig.options && fieldConfig.options.length === 0) {
                            // Buscar opciones centralizadas
                            for (const [key, options] of Object.entries(centralizedOptions)) {
                                if (fieldConfig.label === key) {
                                    options.forEach(option => {
                                        const optionElement = document.createElement('option');
                                        optionElement.value = option;
                                        optionElement.textContent = option;
                                        input.appendChild(optionElement);
                                    });
                                    break;
                                }
                            }
                        }

                        // Identificar y guardar referencias a los campos de custodia
                        if (fieldConfig.special === 'custody_type') {
                            custodyTypeElement = input;
                        } else if (fieldConfig.special === 'custody_name') {
                            custodyNameElement = input;
                            custodyNameElement.disabled = true;
                        }

                    } else {
                        input = document.createElement('input');
                        const isNumeric = fieldConfig.type === 'number';
                        input.type = isNumeric ? 'text' : fieldConfig.type;

                        // Aplicar atributos si existen
                        if (fieldConfig.attributes) {
                            Object.keys(fieldConfig.attributes).forEach(attr => {
                                input.setAttribute(attr, fieldConfig.attributes[attr]);
                            });
                        }

                        // Generar código automático para campos autogenerados
                        if (fieldConfig.autogenerated) {
                            input.value = generateCode();
                            input.readOnly = true;
                        }

                        // Agregar span de error para campos numéricos
                        if (isNumeric) {
                            const step = fieldConfig.attributes.step;
                            const errorSpan = document.createElement('span');
                            errorSpan.className = 'error-message';
                            errorSpan.style.display = 'none';
                            errorSpan.textContent = '';
                            input.errorSpan = errorSpan;

                            if (step) {
                                input.setAttribute('placeholder', step === '1' ? '0' : '0.' + '0'.repeat(step.split('.')[1]?.length || 2));
                            }
                        }
                    }

                    input.addEventListener('change', checkFormCompletion);
                    input.addEventListener('input', checkFormCompletion);

                    // Si es un campo calculado, configurarlo
                    /*if (fieldConfig.calculated) {
                        if (fieldConfig.type === "text") {
                            input.readOnly = true;
                            input.style.backgroundColor = '#f0f8ff';
                            input.style.borderLeft = '3px solid #005C97';
                        }
                        input.style.backgroundColor = '#f0f8ff';
                        input.style.borderLeft = '3px solid #005C97';
                    }*/

                    /*
                    // En showFields(), donde configuras campos calculados:
                    if (fieldConfig.calculated) {
                        if (fieldConfig.type === "text") {
                            input.readOnly = true;
                            input.style.backgroundColor = '#f0f8ff';        // Azul claro (no editable)
                            input.style.borderLeft = '3px solid #005C97';
                        } else if (fieldConfig.type === "number") {
                            // Diferenciar si es editable o no
                            if (fieldConfig.attributes && fieldConfig.attributes.readonly) {
                                // ✅ Calculado NO EDITABLE
                                input.readOnly = true;
                                input.style.backgroundColor = '#f0f8ff';    // Azul claro
                                input.style.borderLeft = '3px solid #005C97';
                            } else {
                                // ✅ Calculado EDITABLE
                                input.style.backgroundColor = '#f9f9f9';    // Gris muy claro
                                input.style.borderLeft = '3px solid #28a745'; // Verde
                            }
                        }
                    }*/

                    if (fieldConfig.calculated) {
                        if (fieldConfig.type === "text") {
                            // Text calculados siempre son readonly
                            input.readOnly = true;
                            input.style.backgroundColor = '#f5f5f5';      // Gris claro (readonly)
                            input.style.borderLeft = '3px solid #6c757d'; // Gris
                        } else if (fieldConfig.type === "number") {
                            if (fieldConfig.attributes && fieldConfig.attributes.readonly) {
                                // ✅ Number calculado NO EDITABLE
                                input.readOnly = true;
                                input.style.backgroundColor = '#f5f5f5';      // Gris claro (readonly)
                                input.style.borderLeft = '3px solid #6c757d'; // Gris
                            } else {
                                // ✅ Number calculado EDITABLE
                                input.style.backgroundColor = '#f0f8ff';      // Azul muy claro (editable)
                                input.style.borderLeft = '3px solid #005C97'; // Azul (indica "calculado pero editable")
                            }
                        }
                    }


                    // Después del bloque if (fieldConfig.calculated), agregar:
                    if (fieldConfig.autoFilled) {
                        input.style.backgroundColor = '#f0f8ff';      // Azul muy claro
                        input.style.borderLeft = '3px solid #005C97'; // Azul
                    }

                    fieldGroup.appendChild(label);
                    fieldGroup.appendChild(input);

                    // Agregar span de error si lo tiene
                    if (input.errorSpan) {
                        fieldGroup.appendChild(input.errorSpan);
                    }

                    dynamicFields.appendChild(fieldGroup);

                    // Aplicar AutoNumeric después de agregar al DOM
                    if (fieldConfig.type === "number") {
                        const step = fieldConfig.attributes.step;
                        const decimalPlaces = step?.split('.')?.[1]?.length || 0;

                        // new AutoNumeric(input, {
                        //     digitGroupSeparator: ',',
                        //     decimalCharacter: '.',
                        //     decimalPlaces,
                        //     unformatOnSubmit: true,
                        //     minimumValue: '0'
                        // });


                        new AutoNumeric(input, {
                            digitGroupSeparator: ',',
                            decimalCharacter: '.',
                            decimalPlaces,
                            unformatOnSubmit: true,
                            minimumValue: '0',              // ✅ Mínimo cero (sin negativos)
                            maximumValue: '999999999999',   // ✅ Máximo amplio (billones)
                            showWarnings: false             // ✅ Silenciar warnings
                        });
                    }
                });

                // Configurar la dependencia entre tipo y nombre de custodia
                if (custodyTypeElement && custodyNameElement) {
                    handleCustodyDependency(custodyTypeElement, custodyNameElement);
                }

                // Configurar campos especiales
                updateSpecialFields();

                // ✅ CONFIGURAR TODOS LOS LISTENERS DE CÁLCULO
                setupCalculationListeners();
            }

            checkFormCompletion();
        }

        // ===================================================
        // 🔗 FUNCIONES PARA CAMPOS ESPECIALES
        // ===================================================

        /**
 * Maneja la inserción dinámica de campos de monto según la estructura seleccionada
 */
        function handleStructureChange(structureValue, structureIndex) {
            const dynamicFields = document.getElementById('dynamicFields');
            const existingInputs = dynamicFields.querySelectorAll('input, select');

            // Remover campos de monto existentes si los hay
            removeExistingMontoFields();

            // 🎯 Actualizar Moneda DPZ automáticamente
            updateMonedaDPZ(structureValue);


            if (!structureValue) return;

            let firstField, secondField;

            if (structureValue === "PEN-USD-PEN") {
                firstField = {
                    label: "Monto Soles",
                    type: "number",
                    attributes: { step: "0.01" },
                    calculationId: "monto_soles_input"
                    // ❌ NO TIENE calculated: true (es input manual)
                };
                secondField = {
                    label: "Monto Dólares",
                    type: "number",
                    attributes: { step: "0.01" }, // 🔥 SIN readonly: true
                    calculated: true, // ✅ Es calculado
                    calculationId: "monto_dolares_calc"
                };
            } else if (structureValue === "USD-PEN-USD") {
                firstField = {
                    label: "Monto Dólares",
                    type: "number",
                    attributes: { step: "0.01" },
                    calculationId: "monto_dolares_input"
                    // ❌ NO TIENE calculated: true (es input manual)
                };
                secondField = {
                    label: "Monto Soles",
                    type: "number",
                    attributes: { step: "0.01" }, // 🔥 SIN readonly: true
                    calculated: true, // ✅ Es calculado
                    calculationId: "monto_soles_calc"
                };
            }

            // Insertar los campos después del campo "Estructura"
            insertMontoFieldsAfterStructure(firstField, secondField, structureIndex);

            // Actualizar el array currentFields
            updateCurrentFieldsArray(firstField, secondField, structureIndex);

            // Configurar listeners para cálculos
            setupMontoCalculationListeners();


            // 🆕 También generar campos Forward
            handleForwardFields(structureValue);


            // 🆕 LIMPIAR CAMPOS CALCULADOS AL CAMBIAR ESTRUCTURA
            clearCalculatedFields();
        }

        function clearCalculatedFields() {
            const fieldsToClean = [
                "monto_dolares_calc",
                "monto_soles_calc",
                "monto_dolares_input",
                "monto_soles_input",
                "monto_dolares_forward_input",
                "monto_soles_forward_calc",
                "monto_dolares_forward_calc",
                "monto_soles_forward_input",
                "interes_deposito_simple",
                "monto_total_vencimiento",
                "tasa_tea_sintetico"
            ];

            // Limpiar campo "Monto" por label
            const montoField = (() => {
                for (let i = 0; i < currentFields.length; i++) {
                    if (currentFields[i].label === "Monto") {
                        const dynamicFields = document.getElementById('dynamicFields');
                        const inputs = dynamicFields.querySelectorAll('input, select');
                        return { input: inputs[i], config: currentFields[i] };
                    }
                }
                return null;
            })();

            if (montoField) {
                setCalculatedValue(montoField.input, montoField.config, 0);
            }

            // Limpiar campos por calculationId
            fieldsToClean.forEach(calcId => {
                const field = getFieldByCalculationId(calcId);
                if (field) {
                    setCalculatedValue(field.input, field.config, 0);
                }
            });
        }

        function handleForwardFields(structureValue) {
            if (!structureValue) return;

            removeExistingForwardFields();

            let firstForwardField, secondForwardField;

            if (structureValue === "PEN-USD-PEN") {
                firstForwardField = {
                    label: "Monto Dólares",
                    type: "number",

                    attributes: { step: "0.01" },
                    autoFilled: true, // 🆕 NUEVA PROPIEDAD
                    calculationId: "monto_dolares_forward_input"
                };
                secondForwardField = {
                    label: "Monto Soles",
                    type: "number",
                    attributes: { step: "0.01" },
                    calculated: true,
                    calculationId: "monto_soles_forward_calc"
                };
            } else if (structureValue === "USD-PEN-USD") {
                firstForwardField = {
                    label: "Monto Soles",
                    type: "number",
                    attributes: { step: "0.01" },
                    autoFilled: true, // 🆕 NUEVA PROPIEDAD

                    calculationId: "monto_soles_forward_input"
                };
                secondForwardField = {
                    label: "Monto Dólares",
                    type: "number",
                    attributes: { step: "0.01" },
                    calculated: true,
                    calculationId: "monto_dolares_forward_calc"
                };
            }

            insertForwardFieldsAfterTCForward(firstForwardField, secondForwardField);
            updateCurrentFieldsForForward(firstForwardField, secondForwardField);
        }

        function removeExistingForwardFields() {
            const fieldsToRemove = ['monto_soles_forward_input', 'monto_dolares_forward_calc',
                'monto_dolares_forward_input', 'monto_soles_forward_calc'];

            const dynamicFields = document.getElementById('dynamicFields');
            const fieldGroups = dynamicFields.querySelectorAll('.form-group');

            // Remover del DOM
            // fieldGroups.forEach(group => {
            //     const label = group.querySelector('label');
            //     if (label && (label.textContent === "Monto Soles Forward" || label.textContent === "Monto Dólares Forward")) {
            //         group.remove();
            //     }
            // });

            // ✅ CAMBIO: Buscar por calculationId en lugar de label
            fieldGroups.forEach(group => {
                const input = group.querySelector('input, select');
                if (input && input.getAttribute('data-calculation-id')) {
                    const calcId = input.getAttribute('data-calculation-id');
                    if (fieldsToRemove.includes(calcId)) {
                        group.remove();
                    }
                }
            });

            // Limpiar del array currentFields
            currentFields = currentFields.filter(field =>
                !fieldsToRemove.includes(field.calculationId)
            );
        }


        function insertForwardFieldsAfterTCForward(firstField, secondField) {
            const dynamicFields = document.getElementById('dynamicFields');
            let forwardFieldGroup = null;
            const fieldGroups = dynamicFields.querySelectorAll('.form-group');

            // Buscar el campo "Tipo de cambio Forward"
            fieldGroups.forEach(group => {
                const label = group.querySelector('label');
                if (label && label.textContent === "Tipo de cambio Forward") {
                    forwardFieldGroup = group;
                }
            });

            if (forwardFieldGroup) {
                // Crear e insertar el primer campo
                const firstFieldGroup = createFieldElement(firstField);
                forwardFieldGroup.insertAdjacentElement('afterend', firstFieldGroup);

                // Crear e insertar el segundo campo después del primero
                const secondFieldGroup = createFieldElement(secondField);
                firstFieldGroup.insertAdjacentElement('afterend', secondFieldGroup);
            }
        }



        function updateCurrentFieldsForForward(firstField, secondField) {
            // Buscar la posición del campo "Tipo de cambio Forward"
            let forwardFieldIndex = -1;
            for (let i = 0; i < currentFields.length; i++) {
                if (currentFields[i].label === "Tipo de cambio Forward") {
                    forwardFieldIndex = i;
                    break;
                }
            }

            if (forwardFieldIndex !== -1) {
                // Insertar después del campo "Tipo de cambio Forward"
                currentFields.splice(forwardFieldIndex + 1, 0, firstField, secondField);

                setTimeout(() => {
                    setupForwardCalculationListeners();
                    checkFormCompletion();
                }, 100);
            }


            setTimeout(() => {
                setupForwardCalculationListeners();
                setupMontoVencimientoListener(); // 🆕 AQUÍ SE EJECUTA
                checkFormCompletion();
            }, 100);
        }

        function updateForwardFromVencimiento() {
            const montoVencimiento = getFieldValue("Monto estimado al vencimiento");

            const estructuraValue = (() => {
                for (let i = 0; i < currentFields.length; i++) {
                    if (currentFields[i].label === "Estructura") {
                        const dynamicFields = document.getElementById('dynamicFields');
                        const inputs = dynamicFields.querySelectorAll('input, select');
                        return inputs[i].value;
                    }
                }
                return null;
            })();

            if (!montoVencimiento || !estructuraValue) return;

            // Actualizar el primer campo Forward con el valor del vencimiento
            let forwardField = null;
            if (estructuraValue === "PEN-USD-PEN") {
                forwardField = getFieldByCalculationId("monto_dolares_forward_input");
            } else if (estructuraValue === "USD-PEN-USD") {
                forwardField = getFieldByCalculationId("monto_soles_forward_input");
            }

            if (forwardField) {
                setCalculatedValue(forwardField.input, forwardField.config, montoVencimiento);

                // Recalcular el segundo campo Forward
                setTimeout(() => {
                    if (estructuraValue === "PEN-USD-PEN") {
                        calculateForwardDollarsToSoles();
                    } else {
                        calculateForwardSolesToDollars();
                    }
                }, 50);
            }
        }

        /*function calculateForwardSolesToDollars() {
            const montoSolesForward = getFieldValue("Monto Soles Forward");
            const tipoCambioForward = getFieldValue("Tipo de cambio Forward");
            const montoDolaresForwardField = getFieldByCalculationId("monto_dolares_forward_calc");

            if (montoSolesForward !== null && tipoCambioForward !== null && montoDolaresForwardField) {
                const resultado = montoSolesForward / tipoCambioForward;
                setCalculatedValue(montoDolaresForwardField.input, montoDolaresForwardField.config, resultado);
            }
        }

        function calculateForwardDollarsToSoles() {
            const montoDolaresForward = getFieldValue("Monto Dólares Forward");
            const tipoCambioForward = getFieldValue("Tipo de cambio Forward");
            const montoSolesForwardField = getFieldByCalculationId("monto_soles_forward_calc");

            if (montoDolaresForward !== null && tipoCambioForward !== null && montoSolesForwardField) {
                const resultado = montoDolaresForward * tipoCambioForward;
                setCalculatedValue(montoSolesForwardField.input, montoSolesForwardField.config, resultado);
            }
        }*/

        function calculateForwardSolesToDollars() {
            const montoSolesForward = getFieldByCalculationId("monto_soles_forward_input");
            const tipoCambioForward = getFieldValue("Tipo de cambio Forward");
            const montoDolaresForwardField = getFieldByCalculationId("monto_dolares_forward_calc");

            if (montoSolesForward && tipoCambioForward !== null && montoDolaresForwardField) {
                const solesValue = getCalculatedValue(montoSolesForward.input, montoSolesForward.config);
                const resultado = solesValue / tipoCambioForward;
                setCalculatedValue(montoDolaresForwardField.input, montoDolaresForwardField.config, resultado);
            }

            setTimeout(() => calculateTasaTEASintetico(), 50);

        }

        function calculateForwardDollarsToSoles() {
            const montoDolaresForward = getFieldByCalculationId("monto_dolares_forward_input");
            const tipoCambioForward = getFieldValue("Tipo de cambio Forward");
            const montoSolesForwardField = getFieldByCalculationId("monto_soles_forward_calc");

            if (montoDolaresForward && tipoCambioForward !== null && montoSolesForwardField) {
                const dolaresValue = getCalculatedValue(montoDolaresForward.input, montoDolaresForward.config);
                const resultado = dolaresValue * tipoCambioForward;
                setCalculatedValue(montoSolesForwardField.input, montoSolesForwardField.config, resultado);
            }
            setTimeout(() => calculateTasaTEASintetico(), 50);

        }



        function setupForwardCalculationListeners() {
            const montoSolesForwardInput = getFieldByCalculationId("monto_soles_forward_input");
            const montoDolaresForwardInput = getFieldByCalculationId("monto_dolares_forward_input");

            if (montoSolesForwardInput) {
                montoSolesForwardInput.input.addEventListener('input', calculateForwardSolesToDollars);
                montoSolesForwardInput.input.addEventListener('change', calculateForwardSolesToDollars);
            }

            if (montoDolaresForwardInput) {
                montoDolaresForwardInput.input.addEventListener('input', calculateForwardDollarsToSoles);
                montoDolaresForwardInput.input.addEventListener('change', calculateForwardDollarsToSoles);
            }

            // Listener para tipo de cambio Forward
            const tipoCambioForwardField = (() => {
                for (let index = 0; index < currentFields.length; index++) {
                    if (currentFields[index].label === "Tipo de cambio Forward") {
                        const dynamicFields = document.getElementById('dynamicFields');
                        const inputs = dynamicFields.querySelectorAll('input, select');
                        return inputs[index];
                    }
                }
                return null;
            })();

            if (tipoCambioForwardField) {
                tipoCambioForwardField.addEventListener('input', () => {
                    calculateForwardSolesToDollars();
                    calculateForwardDollarsToSoles();
                });
                tipoCambioForwardField.addEventListener('change', () => {
                    calculateForwardSolesToDollars();
                    calculateForwardDollarsToSoles();
                });
            }
        }



        function updateMonedaDPZ(structureValue) {
            // 🎯 USAR setTimeout PARA ASEGURAR QUE EL DOM SE HAYA ACTUALIZADO
            setTimeout(() => {
                const dynamicFields = document.getElementById('dynamicFields');
                const allInputs = dynamicFields.querySelectorAll('input[type="text"]');

                let monedaDPZInput = null;

                // Buscar el input que tiene el placeholder correcto o está readonly
                allInputs.forEach(input => {
                    const label = input.parentElement.querySelector('label');
                    if (label && label.textContent.trim() === "Moneda DPZ") {
                        monedaDPZInput = input;
                    }
                });

                if (monedaDPZInput) {
                    let monedaValue = "";

                    if (structureValue === "USD-PEN-USD") {
                        monedaValue = "PEN";
                    } else if (structureValue === "PEN-USD-PEN") {
                        monedaValue = "USD";
                    }

                    // Forzar la actualización
                    monedaDPZInput.value = monedaValue;
                    monedaDPZInput.setAttribute('value', monedaValue);

                    console.log(`Moneda DPZ actualizada a: ${monedaValue} para estructura: ${structureValue}`);
                } else {
                    console.log("ERROR: Campo Moneda DPZ no encontrado en el DOM");
                }
            }, 100);
        }



        function removeExistingMontoFields_OLD() {
            const fieldsToRemove = ['monto_soles_input', 'monto_dolares_calc', 'monto_dolares_input', 'monto_soles_calc'];

            fieldsToRemove.forEach(calcId => {
                const field = getFieldByCalculationId(calcId);
                if (field) {
                    field.input.parentElement.remove();
                }
            });

            // Limpiar del array currentFields
            currentFields = currentFields.filter(field =>
                !fieldsToRemove.includes(field.calculationId)
            );
        }

        function removeExistingMontoFields() {
            const fieldsToRemove = ['monto_soles_input', 'monto_dolares_calc', 'monto_dolares_input', 'monto_soles_calc'];

            console.log("Removiendo campos existentes...");

            const dynamicFields = document.getElementById('dynamicFields');
            const fieldGroups = dynamicFields.querySelectorAll('.form-group');

            // 🎯 REMOVER DEL DOM PRIMERO
            fieldGroups.forEach(group => {
                const label = group.querySelector('label');
                if (label && (label.textContent === "Monto Soles" || label.textContent === "Monto Dólares")) {
                    console.log(`Removiendo campo: ${label.textContent}`);
                    group.remove();
                }
            });

            // 🎯 LIMPIAR DEL ARRAY currentFields DESPUÉS
            currentFields = currentFields.filter(field =>
                !fieldsToRemove.includes(field.calculationId)
            );

            console.log("Campos removidos. currentFields restantes:", currentFields.length);
        }


        function insertMontoFieldsAfterStructure(firstField, secondField, structureIndex) {
            const dynamicFields = document.getElementById('dynamicFields');

            // 🎯 Buscar el campo "Tipo de cambio Spot" en lugar del índice de estructura
            let spotFieldGroup = null;
            const fieldGroups = dynamicFields.querySelectorAll('.form-group');

            fieldGroups.forEach(group => {
                const label = group.querySelector('label');
                if (label && label.textContent === "Tipo de cambio Spot") {
                    spotFieldGroup = group;
                }
            });

            if (spotFieldGroup) {
                // 🎯 CORRECCIÓN: Insertar los campos en el orden correcto
                // Primero insertar el primer campo (manual)
                const firstFieldGroup = createFieldElement(firstField);
                spotFieldGroup.insertAdjacentElement('afterend', firstFieldGroup);

                // Luego insertar el segundo campo (calculado) después del primero
                const secondFieldGroup = createFieldElement(secondField);
                firstFieldGroup.insertAdjacentElement('afterend', secondFieldGroup);
            }
        }

        function createFieldElement(fieldConfig) {
            const fieldGroup = document.createElement('div');
            fieldGroup.className = 'form-group';

            const label = document.createElement('label');
            label.textContent = fieldConfig.label;

            const input = document.createElement('input');
            input.type = 'text'; // Se aplicará AutoNumeric


            // ✅ AGREGAR: Identificador único
            if (fieldConfig.calculationId) {
                input.setAttribute('data-calculation-id', fieldConfig.calculationId);
            }


            if (fieldConfig.attributes) {
                Object.keys(fieldConfig.attributes).forEach(attr => {
                    input.setAttribute(attr, fieldConfig.attributes[attr]);
                });
            }

            // Aplicar estilos para campos calculados editables
            // if (fieldConfig.calculated) {
            //     input.style.backgroundColor = '#f0f8ff';
            //     input.style.borderLeft = '3px solid #005C97';
            // }

            // 🎯 CORREGIDO: Aplicar estilos según tu lógica existente
            // 🎯 CORREGIDO: Solo aplicar estilos SI es calculated
            if (fieldConfig.calculated) {
                /*if (fieldConfig.attributes && fieldConfig.attributes.readonly) {
                    // ✅ Calculado NO EDITABLE (readonly: true)
                    input.readOnly = true;
                    input.style.backgroundColor = "green";//'#f5f5f5';      // Gris claro (readonly)
                    input.style.borderLeft = '3px solid #6c757d'; // Gris
                } else {
                    // ✅ Calculado EDITABLE (readonly: false o sin readonly)
                    input.style.backgroundColor = 'yellow';// '#f0f8ff';      // Azul muy claro (editable)
                    input.style.borderLeft = '3px solid #005C97'; // Azul (indica "calculado pero editable")
                }*/


                // ✅ Campo calculado EDITABLE (el segundo campo siempre es calculado)
                console.log(`Aplicando estilos calculado a: ${fieldConfig.label}`); // Para debug
                input.style.backgroundColor = '#f0f8ff';      // Azul muy claro (calculado editable)
                input.style.borderLeft = '3px solid #005C97'; // Azul (indica "calculado pero editable")
            }


            // 🆕 AGREGAR ESTA LÓGICA DESPUÉS DE LOS ESTILOS CALCULATED:
            if (fieldConfig.autoFilled) {
                console.log(`Aplicando estilos auto-filled a: ${fieldConfig.label}`);
                input.style.backgroundColor = '#f0f8ff';      // Azul muy claro (como calculado)
                input.style.borderLeft = '3px solid #005C97'; // Azul (indica "auto-completado")
            }

            // Agregar span de error
            const errorSpan = document.createElement('span');
            errorSpan.className = 'error-message';
            errorSpan.style.display = 'none';
            input.errorSpan = errorSpan;

            fieldGroup.appendChild(label);
            fieldGroup.appendChild(input);
            fieldGroup.appendChild(errorSpan);

            // Aplicar AutoNumeric
            const step = fieldConfig.attributes.step;
            const decimalPlaces = step?.split('.')?.[1]?.length || 0;

            // new AutoNumeric(input, {
            //     digitGroupSeparator: ',',
            //     decimalCharacter: '.',
            //     decimalPlaces,
            //     unformatOnSubmit: true,
            //     minimumValue: '0'
            // });


            new AutoNumeric(input, {
                digitGroupSeparator: ',',
                decimalCharacter: '.',
                decimalPlaces,
                unformatOnSubmit: true,
                minimumValue: '0',              // ✅ Mínimo cero (sin negativos)
                maximumValue: '999999999999',   // ✅ Máximo amplio (billones)
                showWarnings: false             // ✅ Silenciar warnings
            });


            // 🆕 AGREGAR DESPUÉS DE AutoNumeric, ANTES del return:
            // const step = fieldConfig.attributes.step;
            if (step) {
                const decimales = step.split('.')?.[1]?.length || 0;
                const placeholderValue = decimales === 0 ? '0' : '0.' + '0'.repeat(decimales);
                input.setAttribute('placeholder', placeholderValue);
            }

            // return fieldGroup;

            return fieldGroup;
        }

        function updateCurrentFieldsArray(firstField, secondField, structureIndex) {
            // Buscar la posición del campo "Tipo de cambio Spot"
            let spotFieldIndex = -1;
            for (let i = 0; i < currentFields.length; i++) {
                if (currentFields[i].label === "Tipo de cambio Spot") {
                    spotFieldIndex = i;
                    break;
                }
            }

            if (spotFieldIndex !== -1) {
                // Insertar después del campo "Tipo de cambio Spot"
                currentFields.splice(spotFieldIndex + 1, 0, firstField, secondField);

                // 🔥 AGREGAR ESTO: Actualizar los listeners después de la inserción
                setTimeout(() => {
                    setupCalculationListeners(); // Reconfigurar listeners
                    checkFormCompletion();       // Verificar formulario
                }, 100);
            }
        }


        function updateSpecialFields() {
            const dynamicFields = document.getElementById('dynamicFields');
            const inputs = dynamicFields.querySelectorAll('input, select');

            currentFields.forEach((fieldConfig, index) => {
                const input = inputs[index];

                if (fieldConfig.special === 'structure_selector') {
                    input.onchange = function () {
                        handleStructureChange(this.value, index);
                        checkFormCompletion();
                    };
                }


                if (fieldConfig.special === 'business_unit') {
                    const businessUnits = getBusinessUnits(currentMarket);
                    input.innerHTML = '<option value="">Seleccione</option>';

                    businessUnits.forEach(unit => {
                        const option = document.createElement('option');
                        option.value = unit;
                        option.textContent = unit;
                        input.appendChild(option);
                    });

                    input.onchange = function () {
                        currentBusinessUnit = this.value;
                        updateBankAccountFields();
                        checkFormCompletion();
                    };
                } else if (fieldConfig.special === 'bank_account') {
                    input.onchange = function () {
                        currentBankAccount = this.value;
                        updateAccountNumberFields();
                        checkFormCompletion();
                    };
                } else if (fieldConfig.special === 'account_number') {
                    input.onchange = function () {
                        checkFormCompletion();
                    };
                }
            });
        }

        function updateBankAccountFields() {
            const dynamicFields = document.getElementById('dynamicFields');
            const inputs = dynamicFields.querySelectorAll('input, select');

            currentFields.forEach((fieldConfig, index) => {
                const input = inputs[index];

                if (fieldConfig.special === 'bank_account') {
                    const bankAccounts = getBankAccounts(currentMarket, currentBusinessUnit);
                    input.innerHTML = '<option value="">Seleccione</option>';

                    bankAccounts.forEach(bank => {
                        const option = document.createElement('option');
                        option.value = bank;
                        option.textContent = bank;
                        input.appendChild(option);
                    });

                    input.value = '';
                    currentBankAccount = '';
                }
            });

            updateAccountNumberFields();
        }

        function updateAccountNumberFields() {
            const dynamicFields = document.getElementById('dynamicFields');
            const inputs = dynamicFields.querySelectorAll('input, select');

            currentFields.forEach((fieldConfig, index) => {
                const input = inputs[index];

                if (fieldConfig.special === 'account_number') {
                    const accountNumbers = getAccountNumbers(currentMarket, currentBusinessUnit, currentBankAccount);
                    input.innerHTML = '<option value="">Seleccione</option>';

                    accountNumbers.forEach(account => {
                        const option = document.createElement('option');
                        option.value = account;
                        option.textContent = account;
                        input.appendChild(option);
                    });

                    input.value = '';
                }
            });
        }

        function handleCustodyDependency(custodyTypeElement, custodyNameElement) {
            custodyTypeElement.addEventListener('change', function () {
                const selectedType = this.value;

                custodyNameElement.innerHTML = '<option value="">Seleccione</option>';

                if (selectedType === 'Local') {
                    custodyNameElement.innerHTML += '<option value="Banco Scotiabank">Banco Scotiabank</option>';
                } else if (selectedType === 'Internacional') {
                    custodyNameElement.innerHTML += '<option value="Banco State Street">Banco State Street</option>';
                    custodyNameElement.innerHTML += '<option value="Banco BBH">Banco BBH</option>';
                    custodyNameElement.innerHTML += '<option value="JP Morgan">JP Morgan</option>';
                }

                custodyNameElement.disabled = !selectedType;
                checkFormCompletion();
            });
        }

        // ===================================================
        // 📄 FUNCIONES DE DOCUMENTOS
        // ===================================================

        function selectArea(area) {
            currentArea = area;

            document.querySelectorAll('.area-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            generateDocumentFields();
        }

        function generateDocumentFields() {
            const container = document.getElementById('documentFields');
            container.innerHTML = '';
            filesUploaded = {};

            const documents = documentRequirements[currentArea] || [];

            documents.forEach((docName, index) => {
                createDocumentField(docName, `${currentArea}_${index}`);
            });
        }

        function createDocumentField(docName, fieldId, isCustom = false) {
            const container = document.getElementById('documentFields');

            const fieldGroup = document.createElement('div');
            fieldGroup.className = 'file-upload-group';
            fieldGroup.id = `field_${fieldId}`;

            const label = document.createElement('label');
            label.textContent = docName;
            if (isCustom) {
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = '✕';
                removeBtn.onclick = () => removeCustomDocument(fieldId);
                label.appendChild(removeBtn);
            }

            const uploadArea = document.createElement('div');
            uploadArea.className = 'file-upload-area';
            uploadArea.onclick = () => triggerFileInput(fieldId);
            uploadArea.innerHTML = `
                <div class="upload-text">📄 Seleccionar archivo</div>
                <div class="upload-text" style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">PDF</div>
            `;

            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.id = fieldId;
            fileInput.style.display = 'none';
            fileInput.accept = '.pdf';
            fileInput.onchange = (e) => handleFileUpload(e.target, docName);

            fieldGroup.appendChild(label);
            fieldGroup.appendChild(uploadArea);
            fieldGroup.appendChild(fileInput);
            container.appendChild(fieldGroup);

            filesUploaded[fieldId] = false;
        }

        function triggerFileInput(inputId) {
            document.getElementById(inputId).click();
        }

        function handleFileUpload(input, documentType) {
            const fileArea = input.previousElementSibling;

            if (input.files.length > 0) {
                const file = input.files[0];
                const fileName = file.name;

                if (fileName.toLowerCase().endsWith('.pdf')) {
                    fileArea.innerHTML = `
                        <div class="file-name">📄 ${fileName}</div>
                        <div class="upload-text" style="font-size: 0.8rem; color: #28a745;">Archivo cargado correctamente</div>
                    `;
                    filesUploaded[input.id] = true;
                } else {
                    fileArea.innerHTML = `
                        <div class="upload-text" style="color: #dc3545;">⌫ Solo se permiten archivos PDF</div>
                        <div class="upload-text" style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">PDF</div>
                    `;
                    input.value = '';
                    filesUploaded[input.id] = false;
                }
            } else {
                fileArea.innerHTML = `
                    <div class="upload-text">📄 Seleccionar archivo</div>
                    <div class="upload-text" style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">PDF</div>
                `;
                filesUploaded[input.id] = false;
            }

            checkFormCompletion();
        }

        function addCustomDocument() {
            const input = document.getElementById('newDocumentName');
            const docName = input.value.trim();

            if (!docName) {
                alert('Por favor ingrese un nombre para el documento');
                return;
            }

            const fieldId = `custom_${currentArea}_${documentCounter++}`;
            createDocumentField(docName, fieldId, true);

            if (!documentRequirements[currentArea + '_custom']) {
                documentRequirements[currentArea + '_custom'] = [];
            }
            documentRequirements[currentArea + '_custom'].push(docName);

            input.value = '';
        }

        function removeCustomDocument(fieldId) {
            const fieldElement = document.getElementById(`field_${fieldId}`);
            if (fieldElement) {
                fieldElement.remove();
                delete filesUploaded[fieldId];
            }
        }

        // ===================================================
        // ✅ FUNCIONES DE VALIDACIÓN
        // ===================================================

        function validarCamposNumericos() {
            const numberInputs = document.querySelectorAll('input[type="number"]');
            let esValido = true;

            numberInputs.forEach(input => {
                const step = input.getAttribute('step');
                const valor = input.value.trim();
                const spanError = input.parentElement.querySelector('.error-message');

                if (!valor || !step || isNaN(valor)) {
                    spanError.style.display = 'none';
                    return;
                }

                let decimalesPermitidos = 0;
                if (step.includes('.')) {
                    decimalesPermitidos = step.split('.')[1].length;
                }

                const partes = valor.split('.');
                const decimalesIngresados = partes[1] ? partes[1].length : 0;

                if (decimalesIngresados > decimalesPermitidos) {
                    esValido = false;
                    if (decimalesPermitidos == 0)
                        spanError.textContent = `Ingrese número entero.`;
                    else
                        spanError.textContent = `Máximo ${decimalesPermitidos} decimales permitidos.`;
                    spanError.style.display = 'block';
                } else {
                    spanError.style.display = 'none';
                }
            });

            return esValido;
        }

        function validarCamposNumericosNoCero() {
            let hayError = false;

            currentFields.forEach((fieldConfig, index) => {
                const dynamicFields = document.getElementById('dynamicFields');
                const input = dynamicFields.querySelectorAll('input, select')[index];

                if (fieldConfig.type === 'number') {
                    const valor = AutoNumeric.getNumber(input);

                    if (valor === 0) {
                        input.errorSpan.textContent = 'El valor no puede ser cero.';
                        input.errorSpan.style.display = 'block';
                        hayError = true;
                    } else {
                        input.errorSpan.textContent = '';
                        input.errorSpan.style.display = 'none';
                    }
                }
            });

            return !hayError;
        }

        function checkFormCompletion() {
            const dynamicFields = document.getElementById('dynamicFields');
            const inputs = dynamicFields.querySelectorAll('input, select');
            const registerButton = document.getElementById('registerButton');

            let allFieldsCompleted = true;

            for (let input of inputs) {
                if (!input.readOnly && !input.value.trim()) {
                    allFieldsCompleted = false;
                    break;
                }
            }

            const allFilesUploaded = Object.values(filesUploaded).every(uploaded => uploaded);

            if (allFieldsCompleted && allFilesUploaded && currentFields.length > 0) {
                registerButton.classList.add('enabled');
                registerButton.disabled = false;
            } else {
                registerButton.classList.remove('enabled');
                registerButton.disabled = true;
            }
        }

        // ===================================================
        // 💾 FUNCIÓN DE REGISTRO
        // ===================================================

        function registerInvestment() {
            const registerButton = document.getElementById('registerButton');
            const successMessage = document.getElementById('successMessage');

            if (registerButton.disabled) return;

            if (!validarCamposNumericos()) return;

            if (!validarCamposNumericosNoCero()) {
                return;
            }

            registerButton.textContent = 'Guardando...';
            registerButton.disabled = true;
            registerButton.classList.remove('enabled');

            setTimeout(() => {
                successMessage.textContent = '✅ Inversión financiera registrada correctamente. Código del instrumento: INV-21742513';
                successMessage.classList.remove('hidden');

                registerButton.textContent = 'Registrar inversión';
                registerButton.disabled = false;
                registerButton.classList.add('enabled');

                successMessage.scrollIntoView({ behavior: 'smooth' });
            }, 1500);
        }

        // ===================================================
        // 🚀 INICIALIZACIÓN
        // ===================================================

        document.addEventListener('DOMContentLoaded', function () {
            const claseActivoSelect = document.getElementById("claseActivo");
            claseActivoSelect.innerHTML = '<option value="">Seleccione</option>';
            Object.keys(investmentData).forEach(key => {
                claseActivoSelect.innerHTML += `<option value="${key}">${key}</option>`;
            });
            checkFormCompletion();
            generateDocumentFields();
        });

    </script>
</body>

</html>
